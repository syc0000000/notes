{"ID":"20241104011711-umnpb9r","Spec":"1","Type":"NodeDocument","Properties":{"custom-common-Halo-yaml":"---_esc_newline_created: '2024-11-04 01:17:11'_esc_newline_updated: '2024-11-09 03:56:31'_esc_newline_title: Zookeeper与分布式理论_esc_newline_slug: zookeeper-and-distributed-theory-klgg9_esc_newline_permalink: siyuan://blocks/20241104011711-umnpb9r_esc_newline_tags:_esc_newline_  - 面经_esc_newline_categories: []_esc_newline_---","custom-picgo-file-map-key":"\u0026#123;\u0026quot;f14fa905a9e0f25c33d23ac5520a8f7b\u0026quot;:\u0026#123;\u0026quot;name\u0026quot;:\u0026quot;image-20241108140001-v167j1k.png\u0026quot;,\u0026quot;hash\u0026quot;:\u0026quot;f14fa905a9e0f25c33d23ac5520a8f7b\u0026quot;,\u0026quot;originUrl\u0026quot;:\u0026quot;assets/image-20241108140001-v167j1k.png\u0026quot;,\u0026quot;url\u0026quot;:\u0026quot;https://syc-test111.oss-cn-chengdu.aliyuncs.com/20241108140001.png\u0026quot;,\u0026quot;alt\u0026quot;:\u0026quot;image.png\u0026quot;,\u0026quot;title\u0026quot;:\u0026quot;image.png\u0026quot;,\u0026quot;isLocal\u0026quot;:false,\u0026quot;blockId\u0026quot;:\u0026quot;\u0026quot;\u0026#125;,\u0026quot;5a0f44c30aaf14d2ff0ed71ea0271ed5\u0026quot;:\u0026#123;\u0026quot;name\u0026quot;:\u0026quot;image-20241108140917-xmy6awi.png\u0026quot;,\u0026quot;hash\u0026quot;:\u0026quot;5a0f44c30aaf14d2ff0ed71ea0271ed5\u0026quot;,\u0026quot;originUrl\u0026quot;:\u0026quot;assets/image-20241108140917-xmy6awi.png\u0026quot;,\u0026quot;url\u0026quot;:\u0026quot;https://syc-test111.oss-cn-chengdu.aliyuncs.com/20241108140917.png\u0026quot;,\u0026quot;alt\u0026quot;:\u0026quot;image.png\u0026quot;,\u0026quot;title\u0026quot;:\u0026quot;image.png\u0026quot;,\u0026quot;isLocal\u0026quot;:false,\u0026quot;blockId\u0026quot;:\u0026quot;\u0026quot;\u0026#125;,\u0026quot;f9c672048a043b795d6937b494846a23\u0026quot;:\u0026#123;\u0026quot;name\u0026quot;:\u0026quot;image-20241108164503-762efqv.png\u0026quot;,\u0026quot;hash\u0026quot;:\u0026quot;f9c672048a043b795d6937b494846a23\u0026quot;,\u0026quot;originUrl\u0026quot;:\u0026quot;assets/image-20241108164503-762efqv.png\u0026quot;,\u0026quot;url\u0026quot;:\u0026quot;https://syc-test111.oss-cn-chengdu.aliyuncs.com/20241108164503.png\u0026quot;,\u0026quot;alt\u0026quot;:\u0026quot;image.png\u0026quot;,\u0026quot;title\u0026quot;:\u0026quot;image.png\u0026quot;,\u0026quot;isLocal\u0026quot;:false,\u0026quot;blockId\u0026quot;:\u0026quot;\u0026quot;\u0026#125;,\u0026quot;8c81d4614961799e502a8c29d4768ed0\u0026quot;:\u0026#123;\u0026quot;name\u0026quot;:\u0026quot;image-20241108165753-6xo9aoh.png\u0026quot;,\u0026quot;hash\u0026quot;:\u0026quot;8c81d4614961799e502a8c29d4768ed0\u0026quot;,\u0026quot;originUrl\u0026quot;:\u0026quot;assets/image-20241108165753-6xo9aoh.png\u0026quot;,\u0026quot;url\u0026quot;:\u0026quot;https://syc-test111.oss-cn-chengdu.aliyuncs.com/20241108165753.png\u0026quot;,\u0026quot;alt\u0026quot;:\u0026quot;image.png\u0026quot;,\u0026quot;title\u0026quot;:\u0026quot;image.png\u0026quot;,\u0026quot;isLocal\u0026quot;:false,\u0026quot;blockId\u0026quot;:\u0026quot;\u0026quot;\u0026#125;,\u0026quot;6e5fee694a4352dbd89349aeb8d69d6c\u0026quot;:\u0026#123;\u0026quot;name\u0026quot;:\u0026quot;image-20241108170027-rr4cwgf.png\u0026quot;,\u0026quot;hash\u0026quot;:\u0026quot;6e5fee694a4352dbd89349aeb8d69d6c\u0026quot;,\u0026quot;originUrl\u0026quot;:\u0026quot;assets/image-20241108170027-rr4cwgf.png\u0026quot;,\u0026quot;url\u0026quot;:\u0026quot;https://syc-test111.oss-cn-chengdu.aliyuncs.com/20241108170025.png\u0026quot;,\u0026quot;alt\u0026quot;:\u0026quot;image.png\u0026quot;,\u0026quot;title\u0026quot;:\u0026quot;image.png\u0026quot;,\u0026quot;isLocal\u0026quot;:false,\u0026quot;blockId\u0026quot;:\u0026quot;\u0026quot;\u0026#125;,\u0026quot;9cfc467ad8f418d8310c7d7edf013874\u0026quot;:\u0026#123;\u0026quot;name\u0026quot;:\u0026quot;image-20241108170029-03aedtc.png\u0026quot;,\u0026quot;hash\u0026quot;:\u0026quot;9cfc467ad8f418d8310c7d7edf013874\u0026quot;,\u0026quot;originUrl\u0026quot;:\u0026quot;assets/image-20241108170029-03aedtc.png\u0026quot;,\u0026quot;url\u0026quot;:\u0026quot;https://syc-test111.oss-cn-chengdu.aliyuncs.com/20241108170025.png\u0026quot;,\u0026quot;alt\u0026quot;:\u0026quot;image.png\u0026quot;,\u0026quot;title\u0026quot;:\u0026quot;image.png\u0026quot;,\u0026quot;isLocal\u0026quot;:false,\u0026quot;blockId\u0026quot;:\u0026quot;\u0026quot;\u0026#125;,\u0026quot;e94339fe9e3b531e2352969d88d624cd\u0026quot;:\u0026#123;\u0026quot;name\u0026quot;:\u0026quot;image-20241108170031-iqni4cs.png\u0026quot;,\u0026quot;hash\u0026quot;:\u0026quot;e94339fe9e3b531e2352969d88d624cd\u0026quot;,\u0026quot;originUrl\u0026quot;:\u0026quot;assets/image-20241108170031-iqni4cs.png\u0026quot;,\u0026quot;url\u0026quot;:\u0026quot;https://syc-test111.oss-cn-chengdu.aliyuncs.com/20241108170025.png\u0026quot;,\u0026quot;alt\u0026quot;:\u0026quot;image.png\u0026quot;,\u0026quot;title\u0026quot;:\u0026quot;image.png\u0026quot;,\u0026quot;isLocal\u0026quot;:false,\u0026quot;blockId\u0026quot;:\u0026quot;\u0026quot;\u0026#125;,\u0026quot;b1e6b0dc507dcd9d97889615c3af470c\u0026quot;:\u0026#123;\u0026quot;name\u0026quot;:\u0026quot;image-20241108170033-12pi7w1.png\u0026quot;,\u0026quot;hash\u0026quot;:\u0026quot;b1e6b0dc507dcd9d97889615c3af470c\u0026quot;,\u0026quot;originUrl\u0026quot;:\u0026quot;assets/image-20241108170033-12pi7w1.png\u0026quot;,\u0026quot;url\u0026quot;:\u0026quot;https://syc-test111.oss-cn-chengdu.aliyuncs.com/20241108170025.png\u0026quot;,\u0026quot;alt\u0026quot;:\u0026quot;image.png\u0026quot;,\u0026quot;title\u0026quot;:\u0026quot;image.png\u0026quot;,\u0026quot;isLocal\u0026quot;:false,\u0026quot;blockId\u0026quot;:\u0026quot;\u0026quot;\u0026#125;,\u0026quot;7d502284512fd2261c806ba958a4f4a0\u0026quot;:\u0026#123;\u0026quot;name\u0026quot;:\u0026quot;image-20241108211203-zu6uqvu.png\u0026quot;,\u0026quot;hash\u0026quot;:\u0026quot;7d502284512fd2261c806ba958a4f4a0\u0026quot;,\u0026quot;originUrl\u0026quot;:\u0026quot;assets/image-20241108211203-zu6uqvu.png\u0026quot;,\u0026quot;url\u0026quot;:\u0026quot;https://syc-test111.oss-cn-chengdu.aliyuncs.com/20241108211203.png\u0026quot;,\u0026quot;alt\u0026quot;:\u0026quot;image.png\u0026quot;,\u0026quot;title\u0026quot;:\u0026quot;image.png\u0026quot;,\u0026quot;isLocal\u0026quot;:false,\u0026quot;blockId\u0026quot;:\u0026quot;\u0026quot;\u0026#125;,\u0026quot;656ef11544d1d71da3785ab54487f0b7\u0026quot;:\u0026#123;\u0026quot;name\u0026quot;:\u0026quot;image-20241108212045-ky3z2wy.png\u0026quot;,\u0026quot;hash\u0026quot;:\u0026quot;656ef11544d1d71da3785ab54487f0b7\u0026quot;,\u0026quot;originUrl\u0026quot;:\u0026quot;assets/image-20241108212045-ky3z2wy.png\u0026quot;,\u0026quot;url\u0026quot;:\u0026quot;https://syc-test111.oss-cn-chengdu.aliyuncs.com/20241108212045.png\u0026quot;,\u0026quot;alt\u0026quot;:\u0026quot;image.png\u0026quot;,\u0026quot;title\u0026quot;:\u0026quot;image.png\u0026quot;,\u0026quot;isLocal\u0026quot;:false,\u0026quot;blockId\u0026quot;:\u0026quot;\u0026quot;\u0026#125;,\u0026quot;cdddecc3e3a20bc989ee7936c475af06\u0026quot;:\u0026#123;\u0026quot;name\u0026quot;:\u0026quot;image-20241109025437-mra5ypg.png\u0026quot;,\u0026quot;hash\u0026quot;:\u0026quot;cdddecc3e3a20bc989ee7936c475af06\u0026quot;,\u0026quot;originUrl\u0026quot;:\u0026quot;assets/image-20241109025437-mra5ypg.png\u0026quot;,\u0026quot;url\u0026quot;:\u0026quot;https://syc-test111.oss-cn-chengdu.aliyuncs.com/image-20241109025437-mra5ypg.png\u0026quot;,\u0026quot;alt\u0026quot;:\u0026quot;image\u0026quot;,\u0026quot;title\u0026quot;:\u0026quot;\u0026quot;,\u0026quot;isLocal\u0026quot;:false,\u0026quot;blockId\u0026quot;:\u0026quot;20241109025437-1mhkzzq\u0026quot;\u0026#125;,\u0026quot;642e377868f10fa1a546e8aa6837cc84\u0026quot;:\u0026#123;\u0026quot;name\u0026quot;:\u0026quot;image-20241109025221-gtnut6f.png\u0026quot;,\u0026quot;hash\u0026quot;:\u0026quot;642e377868f10fa1a546e8aa6837cc84\u0026quot;,\u0026quot;originUrl\u0026quot;:\u0026quot;assets/image-20241109025221-gtnut6f.png\u0026quot;,\u0026quot;url\u0026quot;:\u0026quot;https://syc-test111.oss-cn-chengdu.aliyuncs.com/image-20241109025221-gtnut6f.png\u0026quot;,\u0026quot;alt\u0026quot;:\u0026quot;image\u0026quot;,\u0026quot;title\u0026quot;:\u0026quot;\u0026quot;,\u0026quot;isLocal\u0026quot;:false,\u0026quot;blockId\u0026quot;:\u0026quot;20241109025437-1mhkzzq\u0026quot;\u0026#125;,\u0026quot;aac49490cea7a870e53754440af14e3e\u0026quot;:\u0026#123;\u0026quot;name\u0026quot;:\u0026quot;4-20241109023710-dppnt4e.gif\u0026quot;,\u0026quot;hash\u0026quot;:\u0026quot;aac49490cea7a870e53754440af14e3e\u0026quot;,\u0026quot;originUrl\u0026quot;:\u0026quot;assets/4-20241109023710-dppnt4e.gif\u0026quot;,\u0026quot;url\u0026quot;:\u0026quot;https://syc-test111.oss-cn-chengdu.aliyuncs.com/4-20241109023710-dppnt4e.gif\u0026quot;,\u0026quot;alt\u0026quot;:\u0026quot;4\u0026quot;,\u0026quot;title\u0026quot;:\u0026quot;\u0026quot;,\u0026quot;isLocal\u0026quot;:false,\u0026quot;blockId\u0026quot;:\u0026quot;20241109025437-1mhkzzq\u0026quot;\u0026#125;,\u0026quot;4d2540914fecb453a2c8990219bb2e15\u0026quot;:\u0026#123;\u0026quot;name\u0026quot;:\u0026quot;2-20241109023328-edhngpk.gif\u0026quot;,\u0026quot;hash\u0026quot;:\u0026quot;4d2540914fecb453a2c8990219bb2e15\u0026quot;,\u0026quot;originUrl\u0026quot;:\u0026quot;assets/2-20241109023328-edhngpk.gif\u0026quot;,\u0026quot;url\u0026quot;:\u0026quot;https://syc-test111.oss-cn-chengdu.aliyuncs.com/2-20241109023328-edhngpk.gif\u0026quot;,\u0026quot;alt\u0026quot;:\u0026quot;2\u0026quot;,\u0026quot;title\u0026quot;:\u0026quot;\u0026quot;,\u0026quot;isLocal\u0026quot;:false,\u0026quot;blockId\u0026quot;:\u0026quot;20241109025437-1mhkzzq\u0026quot;\u0026#125;\u0026#125;","id":"20241104011711-umnpb9r","tags":"面经","title":"Zookeeper与分布式理论","type":"doc","updated":"20241111011734"},"Children":[{"ID":"20241104011711-w573fjr","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20241104011711-w573fjr","updated":"20241104012801"},"Children":[{"Type":"NodeText","Data":"Part1 分布式一致性"}]},{"ID":"20241104011928-anzxcez","Type":"NodeParagraph","Properties":{"id":"20241104011928-anzxcez","updated":"20241104012102"},"Children":[{"Type":"NodeText","Data":"通信故障、请求三态（成功、失败、超时）、节点故障等，这些问题会导致一系例数据不一致的问题，那么分布式一致性算法就是用来解决这个问题的。"}]},{"ID":"20241104012127-dmebz40","Type":"NodeParagraph","Properties":{"id":"20241104012127-dmebz40","updated":"20241104012127"},"Children":[{"Type":"NodeText","Data":"理论是指导业界实现的纲领，也是提炼了多年研究的精华，在分布式一致性领域，最主要的指导理论是CAP和BASE两个。"}]},{"ID":"20241104012105-kwofmko","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20241104012105-kwofmko","updated":"20241104012801"},"Children":[{"Type":"NodeText","Data":"CAP理论"}]},{"ID":"20241104012120-nxwgxhx","Type":"NodeParagraph","Properties":{"id":"20241104012120-nxwgxhx","updated":"20241104012349"},"Children":[{"Type":"NodeText","Data":"CAP即Consistency 一致性、Availability 可用性、Partition-torlerance 分区容忍性。具体而言，CAP描述了分布式一致性的三个维度："}]},{"ID":"20241104012349-ybdpjb1","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20241104012349-ybdpjb1","updated":"20241104012600"},"Children":[{"ID":"20241104012352-xi0mzw9","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"MS4=","Num":1},"Properties":{"id":"20241104012352-xi0mzw9","updated":"20241104012352"},"Children":[{"ID":"20241104012352-d6nqeoo","Type":"NodeParagraph","Properties":{"id":"20241104012352-d6nqeoo","updated":"20241104012406"},"Children":[{"Type":"NodeText","Data":"一致性：每次读操作都能保证返回的是最新数据；在分布式系统中，如果能针对一个数据项的更新执行成功后，所有的请求都可以读到其最新的值，这样的系统就被认为具有严格的一致性。"}]}]},{"ID":"20241104012408-yfa7kyp","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"Mi4=","Num":2},"Properties":{"id":"20241104012408-yfa7kyp","updated":"20241104012408"},"Children":[{"ID":"20241104012408-2kaadep","Type":"NodeParagraph","Properties":{"id":"20241104012408-2kaadep","updated":"20241104012427"},"Children":[{"Type":"NodeText","Data":"可用性：任何一个没有发生故障的节点，会在合理的时间内返回一个正常的结果，也就是对于每一个请求总能够在有限时间内返回结果。"}]}]},{"ID":"20241104012428-tqobxrd","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"My4=","Num":3},"Properties":{"id":"20241104012428-tqobxrd","updated":"20241104012600"},"Children":[{"ID":"20241104012428-5tyznpe","Type":"NodeParagraph","Properties":{"id":"20241104012428-5tyznpe","updated":"20241104012600"},"Children":[{"Type":"NodeText","Data":"分区容忍性：当节点间出现网络分区，照样可以提供满足一致性和可用性的服务。"}]}]}]},{"ID":"20241104012602-m3ho4ea","Type":"NodeBlockquote","Properties":{"id":"20241104012602-m3ho4ea","updated":"20241104012624"},"Children":[{"Type":"NodeBlockquoteMarker","Data":"\u003e"},{"ID":"20241104012604-6fplimh","Type":"NodeParagraph","Properties":{"id":"20241104012604-6fplimh","updated":"20241104012609"},"Children":[{"Type":"NodeText","Data":"网络分区："}]},{"ID":"20241104012609-syfcnye","Type":"NodeParagraph","Properties":{"id":"20241104012609-syfcnye","updated":"20241104012624"},"Children":[{"Type":"NodeText","Data":"网络分区（Partition）是指在分布式系统中，由于网络通信故障或其他原因，系统被分割成两个或多个独立的部分，"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"这些部分之间无法进行正常的通信"},{"Type":"NodeText","Data":"。这种情况下，系统的一部分可能无法感知到另一部分的存在，从而无法进行数据同步和状态更新。"}]}]},{"ID":"20241104012748-elufryj","Type":"NodeParagraph","Properties":{"id":"20241104012748-elufryj","updated":"20241104012801"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"CAP指出，一个分布式系统只能满足三项中的两项而不可能满足全部三项。"},{"Type":"NodeText","Data":"既然CAP理论无法全部满足，为了指导工业实现，就需要降低标准，因此出现了BASE理论。"}]},{"ID":"20241104012753-q6tazb9","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20241104012753-q6tazb9","updated":"20241104013200"},"Children":[{"Type":"NodeText","Data":"BASE理论"}]},{"ID":"20241104012833-55vp330","Type":"NodeParagraph","Properties":{"id":"20241104012833-55vp330","updated":"20241104012833"},"Children":[{"Type":"NodeText","Data":"它的思想是：“即使无法做到强一致性，但每个应用都可以根据自身的业务特点，采用适当的方式来使系统达到最终一致性” 。"}]},{"ID":"20241104013055-8tcppe7","Type":"NodeParagraph","Properties":{"id":"20241104013055-8tcppe7","updated":"20241104013055"},"Children":[{"Type":"NodeText","Data":"BASE理论有三项指标："}]},{"ID":"20241104013055-mt2kl16","Type":"NodeList","ListData":{},"Properties":{"id":"20241104013055-mt2kl16","updated":"20241104013124"},"Children":[{"ID":"20241104013053-b6sj0ff","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20241104013053-b6sj0ff","updated":"20241104013053"},"Children":[{"ID":"20241104013055-3lfqrgx","Type":"NodeParagraph","Properties":{"id":"20241104013055-3lfqrgx","updated":"20241104013055"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"基本可用（Basically Available）"},{"Type":"NodeText","Data":"：是指分布式系统在出现不可预知故障的时候，允许损失部分可用性：比如响应时间、功能降级等；"}]}]},{"ID":"20241104013053-kys7rzg","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20241104013053-kys7rzg","updated":"20241104013124"},"Children":[{"ID":"20241104013055-7ek86i4","Type":"NodeParagraph","Properties":{"id":"20241104013055-7ek86i4","updated":"20241104013124"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"软状态（ Soft State）"},{"Type":"NodeText","Data":"：也称为弱状态，是指允许系统中的数据存在中间状态，并认为该中间状态的存在不会影响系统的整体可用性，即"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"允许系统在不同节点之间进行数据同步的过程存在延时"},{"Type":"NodeText","Data":"；"}]}]},{"ID":"20241104013053-utsqiq5","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20241104013053-utsqiq5","updated":"20241104013053"},"Children":[{"ID":"20241104013055-us80n1t","Type":"NodeParagraph","Properties":{"id":"20241104013055-us80n1t","updated":"20241104013055"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"最终一致性（ Eventual Consistency）"},{"Type":"NodeText","Data":"：强调的是系统中所有的数据副本，在经过一段时间的同步后，最终能够达成一致的状态。"}]}]}]},{"ID":"20241104013056-0goam4h","Type":"NodeParagraph","Properties":{"id":"20241104013056-0goam4h","updated":"20241104013119"},"Children":[{"Type":"NodeText","Data":"BASE理论面向的是大型高可用、可扩展的分布式系统。BASE通过牺牲强一致性来获得可用性，并"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"允许数据短时间内的不一致"},{"Type":"NodeText","Data":"，但是最终达到一致状态。"}]},{"ID":"20241104013159-3xakvc3","Type":"NodeParagraph","Properties":{"id":"20241104013159-3xakvc3","updated":"20241104013159"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20241104013159-viy2989.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20241104013200-g1hb53k","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20241104013200-g1hb53k","updated":"20241108140001"},"Children":[{"Type":"NodeText","Data":"Part2 分布式算法"}]},{"ID":"20241104013231-zk984o4","Type":"NodeParagraph","Properties":{"id":"20241104013231-zk984o4","updated":"20241108135653"},"Children":[{"Type":"NodeText","Data":"这些算法的目的就是为保证分布式一致性而提出的算法，基本上都是保证BASE理论。其实我们今天讨论的准确的说，应该是 状态机复制 的共识（consensus）算法。"}]},{"ID":"20241108163414-shyjqpv","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20241108163414-shyjqpv","updated":"20241108140001"},"Children":[{"Type":"NodeText","Data":"从主从同步到PAXOS"}]},{"ID":"20241108135925-rmvepam","Type":"NodeParagraph","Properties":{"id":"20241108135925-rmvepam","updated":"20241108135950"},"Children":[{"Type":"NodeText","Data":"那么我们很容易想到一个算法："}]},{"ID":"20241108140001-4my643j","Type":"NodeParagraph","Properties":{"id":"20241108140001-4my643j","updated":"20241108140001"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Properties":{"style":"width: 905px;"},"Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20241108140001-v167j1k.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"width: 905px;\"}"},{"Type":"NodeText","Data":"​"}]},{"ID":"20241108170046-vl0a7eo","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20241108170046-vl0a7eo","updated":"20241108140919"},"Children":[{"Type":"NodeText","Data":"两阶段提交"}]},{"ID":"20241108140004-1jze14q","Type":"NodeParagraph","Properties":{"id":"20241108140004-1jze14q","updated":"20241108164748"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong u","TextMarkTextContent":"问题"},{"Type":"NodeText","Data":"：一个节点失败，Master阻塞，导致整个集群不可用，保证了一致性，可用性却大大降低。并且如果出现OK消息丢失的问题，还会导致不同节点的状态不一致的问题。"}]},{"ID":"20241108164503-3u0ugjj","Type":"NodeParagraph","Properties":{"id":"20241108164503-3u0ugjj","updated":"20241108164505"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"https://syc-test111.oss-cn-chengdu.aliyuncs.com/20241108164503.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20241108164505-zk5ik09","Type":"NodeParagraph","Properties":{"id":"20241108164505-zk5ik09","updated":"20241108164631"},"Children":[{"Type":"NodeText","Data":"这通常特指分布式事务的一种实现，但也是一种通用的思想，为防止对副本的写入失败，在复制指令之前先去锁定状态机的应用，主节点发送一个"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"预写命令"},{"Type":"NodeText","Data":"，当其发送给所有的副本并接受到全部确认后，才会真正发送命令同步到副本，而"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"副本节点在确认预写命令后将不再接受其他命令，直到此次命令同步结束"},{"Type":"NodeText","Data":"。"}]},{"ID":"20241108164547-mf94r8u","Type":"NodeParagraph","Properties":{"id":"20241108164547-mf94r8u","updated":"20241108164547"},"Children":[{"Type":"NodeText","Data":"这可以通过给每一个指令分配一个逻辑时序来实现，可以是一个单调递增的数值，用来区分指令序列，因为预写操作的锁定效果，如果副本节点写入后没有回复成功，可以不断重试，直到成功，进而实现最严格的最终一致性。"}]},{"ID":"20241108140917-jqd2t96","Type":"NodeParagraph","Properties":{"id":"20241108140917-jqd2t96","updated":"20241108140919"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Properties":{"style":"width: 778px;"},"Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"https://syc-test111.oss-cn-chengdu.aliyuncs.com/20241108140917.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"width: 778px;\"}"},{"Type":"NodeText","Data":"​"}]},{"ID":"20241108170058-ahi8mpm","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20241108170058-ahi8mpm","updated":"20241108170109"},"Children":[{"Type":"NodeText","Data":"多数派协议"}]},{"ID":"20241104015223-oqdc2i6","Type":"NodeParagraph","Properties":{"id":"20241104015223-oqdc2i6","updated":"20241108164840"},"Children":[{"Type":"NodeTextMark","TextMarkType":"u strong","TextMarkTextContent":"问题"},{"Type":"NodeText","Data":"：等待时间太长，并且极端情况下会陷入无限重试。"}]},{"ID":"20241108164841-53am12j","Type":"NodeParagraph","Properties":{"id":"20241108164841-53am12j","updated":"20241108165003"},"Children":[{"Type":"NodeText","Data":"为了解决这个问题，引入了"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"多数派协议"},{"Type":"NodeText","Data":"，即鸽笼原理。按照客观事实，存在奇数N个抽屉，将N/2+1个信封放到N/2+1个抽屉中，那么再打开任意N/2+1个抽屉，都必然至少有一个存在信封。"}]},{"ID":"20241108165008-urds7x3","Type":"NodeParagraph","Properties":{"id":"20241108165008-urds7x3","updated":"20241108165244"},"Children":[{"Type":"NodeText","Data":"同理，如果主节点发送命令被写入半数以上副本节点成功，那么读取时，只要获得任意半数以上节点的状态，从中选择"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"时序最大"},{"Type":"NodeText","Data":"的那个节点的数据即可。"}]},{"ID":"20241108170109-dd4lo2r","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20241108170109-dd4lo2r","updated":"20241108165756"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"两阶段提交+多数派协议"}]},{"ID":"20241108165028-xi5npmd","Type":"NodeParagraph","Properties":{"id":"20241108165028-xi5npmd","updated":"20241108165636"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong u","TextMarkTextContent":"问题"},{"Type":"NodeText","Data":"：并发情况下的原子性问题，如图："}]},{"ID":"20241108165753-9fmlnfh","Type":"NodeParagraph","Properties":{"id":"20241108165753-9fmlnfh","updated":"20241108165756"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Properties":{"style":"width: 799px;"},"Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"https://syc-test111.oss-cn-chengdu.aliyuncs.com/20241108165753.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"width: 799px;\"}"},{"Type":"NodeText","Data":"​"}]},{"ID":"20241108165755-l6jw8y6","Type":"NodeParagraph","Properties":{"id":"20241108165755-l6jw8y6","updated":"20241108170028"},"Children":[{"Type":"NodeText","Data":"因此，提出最终方案"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"两阶段提交+多数派协议"}]},{"ID":"20241108170022-j2ot9xu","Type":"NodeParagraph","Properties":{"id":"20241108170022-j2ot9xu","updated":"20241108235847"},"Children":[{"Type":"NodeText","Data":"如果将两阶段提交预写阶段中所有副本都要回复确认改为"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"只需要半数以上节点进行确认锁定"},{"Type":"NodeText","Data":"，那么不会有另一个多数派副本集合同意其他的写入，这同样能达到锁定的效果，并且只在第二阶段中有任意的多数派集合写入成功，则数据就不会丢失，因为任意多数派集合都必然包含一个确认预写的副本，更进一步可以说"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color1);"},"TextMarkType":"text","TextMarkTextContent":"，无论"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color1);\"}"},{"Type":"NodeText","Data":"读写，任意的多数派集合总会包含写入的最新指令。"}]},{"ID":"20241108170558-fpxt7n7","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20241108170558-fpxt7n7","updated":"20241109022039"},"Children":[{"Type":"NodeText","Data":"Basic Paxos"}]},{"ID":"20241108172354-3cfvck0","Type":"NodeParagraph","Properties":{"id":"20241108172354-3cfvck0","updated":"20241108172412"},"Children":[{"Type":"NodeText","Data":"我们将上述描述的两阶段提交+多数派协议进行泛化，找到一种更加通用的描述方式：\n首先来定义一下基本的概念范畴："}]},{"ID":"20241108172412-vsxsc3f","Type":"NodeList","ListData":{},"Properties":{"id":"20241108172412-vsxsc3f","updated":"20241108172447"},"Children":[{"ID":"20241108172412-q3aevxw","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20241108172412-q3aevxw","updated":"20241108172447"},"Children":[{"ID":"20241108172412-sum3qzz","Type":"NodeParagraph","Properties":{"id":"20241108172412-sum3qzz","updated":"20241108172447"},"Children":[{"Type":"NodeText","Data":"指令的"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"提议者"},{"Type":"NodeText","Data":"(Proposer)，上文提到的主节点，发起两阶段提交和多数派仲裁的角色。"}]}]},{"ID":"20241108172418-e6egk31","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20241108172418-e6egk31","updated":"20241108172445"},"Children":[{"ID":"20241108172418-pyspqkr","Type":"NodeParagraph","Properties":{"id":"20241108172418-pyspqkr","updated":"20241108172445"},"Children":[{"Type":"NodeText","Data":"指令的"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"决策者"},{"Type":"NodeText","Data":"(Acceptor)，上文提到的副本，根据自身的状态决策是否可以应用此指令到状态机。\n"}]}]},{"ID":"20241108172420-kl9g75w","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20241108172420-kl9g75w","updated":"20241108172444"},"Children":[{"ID":"20241108172420-7snuox6","Type":"NodeParagraph","Properties":{"id":"20241108172420-7snuox6","updated":"20241108172444"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"法定人数"},{"Type":"NodeText","Data":"(Quorum)，上文提到的构成多数派的节点集合。\n"}]}]},{"ID":"20241108172421-pus7pbp","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20241108172421-pus7pbp","updated":"20241108172442"},"Children":[{"ID":"20241108172421-6q70wri","Type":"NodeParagraph","Properties":{"id":"20241108172421-6q70wri","updated":"20241108172442"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"回合"},{"Type":"NodeText","Data":"(Round)，Basic-Paxos协议写入一个值到集群的过程，可以理解为是一个逻辑时序。\n"}]}]}]},{"ID":"20241108172423-7d167j2","Type":"NodeParagraph","Properties":{"id":"20241108172423-7d167j2","updated":"20241109000408"},"Children":[{"Type":"NodeText","Data":"     整个Basic paxos一次完整的指令应用过程是：提案，决策，仲裁，修复/提交。"}]},{"ID":"20241108211203-y6w168u","Type":"NodeParagraph","Properties":{"id":"20241108211203-y6w168u","updated":"20241108211206"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"https://syc-test111.oss-cn-chengdu.aliyuncs.com/20241108211203.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20241108212034-pyw1whd","Type":"NodeParagraph","Properties":{"id":"20241108212034-pyw1whd","updated":"20241108212044"},"Children":[{"Type":"NodeText","Data":"具体操作："}]},{"ID":"20241108212045-fs7de5d","Type":"NodeParagraph","Properties":{"id":"20241108212045-fs7de5d","updated":"20241109022039"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Properties":{"style":"width: 965px;"},"Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"https://syc-test111.oss-cn-chengdu.aliyuncs.com/20241108212045.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"width: 965px;\"}"},{"Type":"NodeText","Data":"​"}]},{"ID":"20241108212546-8d8r2ai","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20241108212546-8d8r2ai","updated":"20241109023853"},"Children":[{"Type":"NodeText","Data":"RAFT"}]},{"ID":"20241109012350-babce23","Type":"NodeParagraph","Properties":{"id":"20241109012350-babce23","updated":"20241109022922"},"Children":[{"Type":"NodeText","Data":"RAFT最大的优化应该是确定了一个Leader，替代PAXOS的任意节点都可以发起请求的机制。这样一来，就不用经过PAXOS的提案阶段（加锁），就可以直接进行第二阶段。不过再加上确认机制要两次传递。"}]},{"ID":"20241109020936-4c2veb4","Type":"NodeParagraph","Properties":{"id":"20241109020936-4c2veb4","updated":"20241109021000"},"Children":[{"Type":"NodeText","Data":"先来个图理解一下正常运行的全过程："}]},{"ID":"20241109021621-lm0rpgf","Type":"NodeParagraph","Properties":{"id":"20241109021621-lm0rpgf","updated":"20241109021621"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Properties":{"style":"width: 649px;"},"Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"1"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/1-20241109021621-ked5uup.gif"},{"Type":"NodeCloseParen"}]},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"width: 649px;\"}"},{"Type":"NodeText","Data":"​"}]},{"ID":"20241109021623-k3fsslr","Type":"NodeParagraph","Properties":{"id":"20241109021623-k3fsslr","updated":"20241109022118"},"Children":[{"Type":"NodeText","Data":"Raft 中使用 日志 来记录所有操作，所有结点都有自己的日志列表来记录所有请求。算法将机器分成三种角色：Leader、Follower 和 Candidate。正常情况下只存在一个 Leader，其他均为 Follower，所有客户端都与 Leader 进行交互。"}]},{"ID":"20241109022412-uh7y4h8","Type":"NodeParagraph","Properties":{"id":"20241109022412-uh7y4h8","updated":"20241109022855"},"Children":[{"Type":"NodeText","Data":"所有操作采用类似两阶段提交的方式，Leader 在收到来自客户端的请求后并不会执行，只是将其写入自己的日志列表中，然后将该操作发送给所有的 Follower。Follower 在收到请求后也只是写入自己的日志列表中然后回复 Leader，当有超过半数的结点写入后 Leader 才会提交该操作并返回给客户端，同时通知所有其他结点提交该操作。"}]},{"ID":"20241109022925-pw8jn1o","Type":"NodeParagraph","Properties":{"id":"20241109022925-pw8jn1o","updated":"20241109022950"},"Children":[{"Type":"NodeText","Data":"在了解了算法的基本工作流程之后，就让我们开始解决其中会遇到的问题，首先就是 Leader 如何而来。"}]},{"ID":"20241109022951-kij7j6h","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20241109022951-kij7j6h","updated":"20241109023853"},"Children":[{"Type":"NodeText","Data":"选取Leader"}]},{"ID":"20241109023003-hxbcurj","Type":"NodeParagraph","Properties":{"id":"20241109023003-hxbcurj","updated":"20241109023047"},"Children":[{"Type":"NodeText","Data":"在算法刚开始时，所有结点都是 Follower，每个结点都会有一个定时器，每次收到来自 Leader 的信息就会更新该定时器。"}]},{"ID":"20241109023417-lrydeen","Type":"NodeParagraph","Properties":{"id":"20241109023417-lrydeen","updated":"20241109023417"},"Children":[{"Type":"NodeText","Data":"如果定时器超时，说明一段时间内没有收到 Leader 的消息，那么就可以认为 Leader 已死或者不存在，那么该结点就会转变成 Candidate，意思为准备竞争成为 Leader。"}]},{"ID":"20241109023417-b6baya7","Type":"NodeParagraph","Properties":{"id":"20241109023417-b6baya7","updated":"20241109023417"},"Children":[{"Type":"NodeText","Data":"成为 Candidate 后结点会向所有其他结点发送请求投票的请求（RequestVote），其他结点在收到请求后会判断是否可以投给他并返回结果。Candidate 如果收到了半数以上的投票就可以成为 Leader，成为之后会立即并在任期内定期发送一个心跳信息通知其他所有结点新的 Leader 信息，并用来重置定时器，避免其他结点再次成为 Candidate。"}]},{"ID":"20241109023328-hmdexng","Type":"NodeParagraph","Properties":{"id":"20241109023328-hmdexng","updated":"20241109023332"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"2"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/2-20241109023328-edhngpk.gif"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20241109023332-sjnk7hy","Type":"NodeParagraph","Properties":{"id":"20241109023332-sjnk7hy","updated":"20241109023842"},"Children":[{"Type":"NodeText","Data":"而如果发生"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"网络分区"},{"Type":"NodeText","Data":"、"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"Leader下线"},{"Type":"NodeText","Data":"这类情况可能会触发Leader重选。特别说下网络分区的问题，因此只有拥有多数结点的分区可以正常工作。而对于少数结点的分区，即使仍存在 Leader，但由于写入日志的结点数量不可能超过半数因此不可能提交操作。"}]},{"ID":"20241109023853-s6oxim9","Type":"NodeParagraph","Properties":{"id":"20241109023853-s6oxim9","updated":"20241109023853"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"4"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/4-20241109023710-dppnt4e.gif"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20241109023844-t4u2zrp","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20241109023844-t4u2zrp","updated":"20241109024143"},"Children":[{"Type":"NodeText","Data":"任期"}]},{"ID":"20241109023920-rj8t5l4","Type":"NodeParagraph","Properties":{"id":"20241109023920-rj8t5l4","updated":"20241109024124"},"Children":[{"Type":"NodeText","Data":"节点维护一个Term变量代表任期，当一个结点成为 Candidate 并向其他结点请求投票时，会将自己的 Term 加 1，表明新一轮的开始以及旧 Leader 的任期结束。"}]},{"ID":"20241109024127-kvz2no6","Type":"NodeParagraph","Properties":{"id":"20241109024127-kvz2no6","updated":"20241109024143"},"Children":[{"Type":"NodeText","Data":"所有结点在收到比自己更新的 Term 之后就会更新自己的 Term 并转成 Follower，而收到过时的消息则拒绝该请求。"}]},{"ID":"20241109024143-qg58e34","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20241109024143-qg58e34","updated":"20241109024430"},"Children":[{"Type":"NodeText","Data":"投票限制"}]},{"ID":"20241109024154-al4qahp","Type":"NodeParagraph","Properties":{"id":"20241109024154-al4qahp","updated":"20241109024342"},"Children":[{"Type":"NodeText","Data":"投票成为新节点时，有一个问题，就是这个新节点必须是拥有完整日志的节点，这一步骤由投票来限制。"}]},{"ID":"20241109024302-6n6i9r1","Type":"NodeParagraph","Properties":{"id":"20241109024302-6n6i9r1","updated":"20241109024419"},"Children":[{"Type":"NodeText","Data":"投票由一个称为 RequestVote 的 RPC 调用进行，请求中除了有 Candidate 自己的 term 和 id 之外，还要带有自己最后一个日志条目的 index 和 term。日志 Term 越大则越新，相同那么 index 较大的认为是更加新的日志。接收者只会投票给拥有相同或者更加新的日志的 Candidate。"}]},{"ID":"20241109024420-yt0f6kz","Type":"NodeParagraph","Properties":{"id":"20241109024420-yt0f6kz","updated":"20241109024429"},"Children":[{"Type":"NodeText","Data":"由于只有日志在被多数结点复制之后才会被提交并返回，所以如果一个 Candidate 并不拥有最新的已被复制的日志，那么他不可能获得多数票，从而保证了 Leader 一定具有所有已被多数拥有的日志（Leader Completeness），在后续同步时会将其同步给所有结点。"}]},{"ID":"20241109024430-vtq1n3h","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20241109024430-vtq1n3h","updated":"20241110173206"},"Children":[{"Type":"NodeText","Data":"日志提交限制"}]},{"ID":"20241109025150-gywpe7m","Type":"NodeParagraph","Properties":{"id":"20241109025150-gywpe7m","updated":"20241109025203"},"Children":[{"Type":"NodeText","Data":"只要日志在多数结点上存在，那么 Leader 就可以提交该操作。但是 Raft 额外限制了 Leader 只对自己任期内的日志条目适用该规则，先前任期的条目只能由当前任期的提交而间接被提交。"}]},{"ID":"20241109025237-ldrw8e2","Type":"NodeParagraph","Properties":{"id":"20241109025237-ldrw8e2","updated":"20241109025242"},"Children":[{"Type":"NodeText","Data":"这条是最抽象的。"}]},{"ID":"20241109025221-lkyrvoq","Type":"NodeParagraph","Properties":{"id":"20241109025221-lkyrvoq","updated":"20241109025224"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20241109025221-gtnut6f.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20241109025300-k4yxyyh","Type":"NodeParagraph","Properties":{"id":"20241109025300-k4yxyyh","updated":"20241109025300"},"Children":[{"Type":"NodeText","Data":"例如论文中图 8 这一 corner case。一开始如 (a) 所示，之后 S1 下线，(b) 中 S5 从 S3 和 S4 处获得了投票成为了 Leader 并收到了一条来自客户端的消息，之后 S5 下线。(c) 中 S1 恢复并成为了 Leader，并且将日志复制给了多数结点，之后进行了一个致命操作，将 index 为 2 的日志提交了，然后 S1 下线。(d) 中 S5 恢复，并从 S2、S3、S4 处获得了足够投票，然后将已提交的 index 为 2 的日志覆盖了。"}]},{"ID":"20241109025300-6lnw2vc","Type":"NodeParagraph","Properties":{"id":"20241109025300-6lnw2vc","updated":"20241109025300"},"Children":[{"Type":"NodeText","Data":"为了解决这个问题，Raft 只允许提交自己任期内的日志，从而日志 2 只能像 (e) 中由于日志 3 同步而被间接提交，避免了 Follower 中由于缺少新任期的日志，使得 S5 能够继续成为 Leader。"}]},{"ID":"20241109025304-2xqrz11","Type":"NodeParagraph","Properties":{"id":"20241109025304-2xqrz11","updated":"20241109025436"},"Children":[{"Type":"NodeText","Data":"总结大图"}]},{"ID":"20241109025437-1mhkzzq","Type":"NodeParagraph","Properties":{"id":"20241109025437-1mhkzzq","updated":"20241110173206"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Properties":{"style":"width: 608px;"},"Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"https://syc-test111.oss-cn-chengdu.aliyuncs.com/image-20241109025437-mra5ypg.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"width: 608px;\"}"},{"Type":"NodeText","Data":"​"}]},{"ID":"20241109030411-klxiw65","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20241109030411-klxiw65","updated":"20241111011610"},"Children":[{"Type":"NodeText","Data":"Part3 Zookeeper"}]},{"ID":"20241110173333-19y4gbp","Type":"NodeParagraph","Properties":{"id":"20241110173333-19y4gbp","updated":"20241110173433"},"Children":[{"Type":"NodeText","Data":"OK，以上是分布式一致性保证的协议和算法，那么在应用上或者说工程上的代表就是Zookeeper。"}]},{"ID":"20241110173434-2ha2i6b","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20241110173434-2ha2i6b","updated":"20241111011610"},"Children":[{"Type":"NodeText","Data":"Zookeeper是什么？"}]},{"ID":"20241110173446-he9zvgj","Type":"NodeParagraph","Properties":{"id":"20241110173446-he9zvgj","updated":"20241111011610"},"Children":[{"Type":"NodeText","Data":"一句话概括：具有分布式一致性保证的内存文件系统（或KV引擎）。它基于自己设计的ZAB协议，ZAB协议出现比Raft更早，因此Raft借鉴了很多ZAB的设计。实际上这个两个协议非常像，因此这里不再单独讨论ZAB。"}]},{"ID":"20241111010936-9cb52jx","Type":"NodeParagraph","Properties":{"id":"20241111010936-9cb52jx","updated":"20241111011427"},"Children":[{"Type":"NodeText","Data":"不同点："},{"Type":"NodeTextMark","TextMarkType":"a","TextMarkAHref":"https://web.archive.org/web/20231003174152/https://my.oschina.net/pingpangkuangmo/blog/782702#expand","TextMarkTextContent":"别人的博客"}]}]}