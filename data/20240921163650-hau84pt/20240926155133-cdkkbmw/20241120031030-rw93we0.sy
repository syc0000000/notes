{"ID":"20241120031030-rw93we0","Spec":"1","Type":"NodeDocument","Properties":{"custom-custom-Haloweb-yaml":"---_esc_newline_created: '2024-11-20 03:10:30'_esc_newline_updated: '2025-04-20 14:26:30'_esc_newline_title: MySQL性能调优_esc_newline_slug: mysql-performance-tuning-zxfbex_esc_newline_permalink: siyuan://blocks/20241120031030-rw93we0_esc_newline_desc: \u0026gt;-_esc_newline_  本文介绍了MySQL数据库的性能调优，主要从应用角度和数据库参数调优两个方面进行探讨。应用角度涵盖了查询语句优化、缓存策略、数据库设计优化等方面；参数调优方面则详细说明了相关配置参数及其调整建议，旨在提高数据库的性能和稳定性和安全性。_esc_newline_tags:_esc_newline_  - 面经_esc_newline_categories: []_esc_newline_---","custom-picgo-file-map-key":"\u0026#123;\u0026quot;faf845a2f0c16250eb9e4b7eeb98c9af\u0026quot;:\u0026#123;\u0026quot;name\u0026quot;:\u0026quot;image-20241120032231-rxek67p.png\u0026quot;,\u0026quot;hash\u0026quot;:\u0026quot;faf845a2f0c16250eb9e4b7eeb98c9af\u0026quot;,\u0026quot;originUrl\u0026quot;:\u0026quot;assets/image-20241120032231-rxek67p.png\u0026quot;,\u0026quot;url\u0026quot;:\u0026quot;https://syc-test111.oss-cn-chengdu.aliyuncs.com/image-20241120032231-rxek67p.png\u0026quot;,\u0026quot;alt\u0026quot;:\u0026quot;image\u0026quot;,\u0026quot;title\u0026quot;:\u0026quot;\u0026quot;,\u0026quot;isLocal\u0026quot;:false,\u0026quot;blockId\u0026quot;:\u0026quot;20241120032231-hryaxwb\u0026quot;\u0026#125;\u0026#125;","id":"20241120031030-rw93we0","tags":"面经","title":"MySQL性能调优","type":"doc","updated":"20241120034840"},"Children":[{"ID":"20241120031030-gpkudme","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20241120031030-gpkudme","updated":"20241120031935"},"Children":[{"Type":"NodeText","Data":"应用角度"}]},{"ID":"20241120031424-h3shlfl","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20241120031424-h3shlfl","updated":"20241120031935"},"Children":[{"Type":"NodeText","Data":"查询语句优化"}]},{"ID":"20241120031916-4zkl4r0","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20241120031916-4zkl4r0","updated":"20241120031916"},"Children":[{"ID":"20241120031916-zm13367","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"MS4=","Num":1},"Properties":{"id":"20241120031916-zm13367","updated":"20241120031916"},"Children":[{"ID":"20241120031916-a7wfn2k","Type":"NodeParagraph","Properties":{"id":"20241120031916-a7wfn2k","updated":"20241120031916"},"Children":[{"Type":"NodeText","Data":"尽量避免使用 SELECT "},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"*"}]},{"Type":"NodeText","Data":"，只查询需要的列。"}]}]},{"ID":"20241120031916-7xguzn9","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"Mi4=","Num":2},"Properties":{"id":"20241120031916-7xguzn9","updated":"20241120031916"},"Children":[{"ID":"20241120031916-6018r52","Type":"NodeParagraph","Properties":{"id":"20241120031916-6018r52","updated":"20241120031916"},"Children":[{"Type":"NodeText","Data":"使用 JOIN 代替子查询，减少嵌套查询的层次。"}]}]},{"ID":"20241120031916-t5c3vjv","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"My4=","Num":3},"Properties":{"id":"20241120031916-t5c3vjv","updated":"20241120031916"},"Children":[{"ID":"20241120031916-1v5w3us","Type":"NodeParagraph","Properties":{"id":"20241120031916-1v5w3us","updated":"20241120031916"},"Children":[{"Type":"NodeText","Data":"避免在 WHERE 子句中使用 LIKE '%value%'，这会导致全表扫描。"}]}]},{"ID":"20241120031916-z0r5dqs","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"NC4=","Num":4},"Properties":{"id":"20241120031916-z0r5dqs","updated":"20241120031916"},"Children":[{"ID":"20241120031916-aln1ufo","Type":"NodeParagraph","Properties":{"id":"20241120031916-aln1ufo","updated":"20241120031916"},"Children":[{"Type":"NodeText","Data":"合理使用 LIMIT 子句，限制查询结果的数量。"}]}]}]},{"ID":"20241120031917-97lqvw9","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20241120031917-97lqvw9","updated":"20241120031957"},"Children":[{"Type":"NodeText","Data":"缓存"}]},{"ID":"20241120031941-a7aytrw","Type":"NodeParagraph","Properties":{"id":"20241120031941-a7aytrw","updated":"20241120031957"},"Children":[{"Type":"NodeText","Data":"在应用程序级别使用缓存（如 Memcached、Redis 等），减少对数据库的直接访问次数。"}]},{"ID":"20241120031957-ardofpq","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20241120031957-ardofpq","updated":"20241120034208"},"Children":[{"Type":"NodeText","Data":"数据库设计优化"}]},{"ID":"20241120032018-yoa514y","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20241120032018-yoa514y","updated":"20241120032022"},"Children":[{"ID":"20241120032022-a0ijvei","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"MS4=","Num":1},"Properties":{"id":"20241120032022-a0ijvei","updated":"20241120032022"},"Children":[{"ID":"20241120032022-nh1r3mz","Type":"NodeParagraph","Properties":{"id":"20241120032022-nh1r3mz","updated":"20241120032023"},"Children":[{"Type":"NodeText","Data":"读写分离：通过主从复制实现读写分离，将读操作分散到多个从服务器上，减轻主服务器的负载。"}]}]},{"ID":"20241120032023-xd5big2","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"Mi4=","Num":2},"Properties":{"id":"20241120032023-xd5big2","updated":"20241120032023"},"Children":[{"ID":"20241120032023-vhrihvh","Type":"NodeParagraph","Properties":{"id":"20241120032023-vhrihvh","updated":"20241120032029"},"Children":[{"Type":"NodeText","Data":"将表中不常用的字段或大型字段（如 TEXT、BLOB）分离到单独的表中，减少主表的大小和 I/O 开销。"}]}]},{"ID":"20241120032030-mjsp3lj","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"My4=","Num":3},"Properties":{"id":"20241120032030-mjsp3lj","updated":"20241120032030"},"Children":[{"ID":"20241120032030-fbv0xnk","Type":"NodeParagraph","Properties":{"id":"20241120032030-fbv0xnk","updated":"20241120032037"},"Children":[{"Type":"NodeText","Data":"分库分表"}]}]},{"ID":"20241120032037-j9a10tf","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"NC4=","Num":4},"Properties":{"id":"20241120032037-j9a10tf","updated":"20241120032037"},"Children":[{"ID":"20241120032037-xhga7lm","Type":"NodeParagraph","Properties":{"id":"20241120032037-xhga7lm","updated":"20241120032045"},"Children":[{"Type":"NodeText","Data":"定期将不常用的旧数据归档到历史表中，减少主表的数据量，提高查询性能。"}]}]},{"ID":"20241120032046-xhqf936","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"NS4=","Num":5},"Properties":{"id":"20241120032046-xhqf936","updated":"20241120032046"},"Children":[{"ID":"20241120032046-8hwxp5m","Type":"NodeParagraph","Properties":{"id":"20241120032046-8hwxp5m","updated":"20241120032103"},"Children":[{"Type":"NodeText","Data":"避免过度索引：因为每个索引都会占用额外的存储空间，并可能影响写操作的性能。"}]}]}]},{"ID":"20241120034208-61q2ehp","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20241120034208-61q2ehp","updated":"20241120034613"},"Children":[{"Type":"NodeText","Data":"MySQL参数调优"}]},{"ID":"20241120034448-t3rsens","Type":"NodeParagraph","Properties":{"id":"20241120034448-t3rsens","updated":"20241120034613"},"Children":[{"Type":"NodeText","Data":"面试可以说：比如说大幅调大InnoDB缓冲区大小，调整至总内存的60%-80%。关闭SSL等"}]},{"ID":"20241120034355-zs9pnp0","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20241120034355-zs9pnp0","style":"line-height: 22px;","updated":"20241120034425"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"cHJvcGVydGllcw=="},{"Type":"NodeCodeBlockCode","Data":"[mysqld_safe]\nlog-error=/data/mysql/log/mysql.log\npid-file=/data/mysql/run/mysqld.pid\n\n[client]\nsocket=/data/mysql/run/mysql.sock\ndefault-character-set=utf8\n\n[mysqld]\nbasedir=/usr/local/mysql\ntmpdir=/data/mysql/tmp\ndatadir=/data/mysql/data\nsocket=/data/mysql/run/mysql.sock\nport=3306\nuser=root\ndefault_authentication_plugin=mysql_native_password\nssl=0 #关闭ssl\nmax_connections=2000 #设置最大连接数\nback_log=2048 #设置会话请求缓存个数\nperformance_schema=OFF #关闭性能模式\nmax_prepared_stmt_count=128000\n\n#file\ninnodb_file_per_table=on #设置每个表一个文件\ninnodb_log_file_size=1500M #设置logfile大小\ninnodb_log_files_in_group=32 #设置logfile组个数\ninnodb_open_files=4000 #设置最大打开表个数\n\n#buffers\ninnodb_buffer_pool_size=230G #设置buffer pool size,一般为服务器内存60%\ninnodb_buffer_pool_instances=16 #设置buffer pool instance个数，提高并发能力\ninnodb_log_buffer_size=64M #设置log buffer size大小\n\n#tune\nsync_binlog=1 #设置每次sync_binlog事务提交刷盘\ninnodb_flush_log_at_trx_commit=1 #每次事务提交时MySQL都会把log buffer的数据写入log file，并且flush(刷到磁盘)中去\ninnodb_use_native_aio=1 #开启异步IO\ninnodb_spin_wait_delay=180 #设置spin_wait_delay 参数，防止进入系统自旋\ninnodb_sync_spin_loops=25 #设置spin_loops 循环次数，防止进入系统自旋\ninnodb_spin_wait_pause_multiplier=25 #设置spin lock循环随机数\ninnodb_flush_method=O_DIRECT #设置innodb数据文件及redo log的打开、刷写模式\ninnodb_io_capacity=20000 # 设置innodb 后台线程每秒最大iops上限\ninnodb_io_capacity_max=40000 #设置压力下innodb 后台线程每秒最大iops上限\ninnodb_lru_scan_depth=9000 #设置page cleaner线程每次刷脏页的数量\ninnodb_page_cleaners=16 #设置将脏数据写入到磁盘的线程数\ntable_open_cache_instances=32 #设置打开句柄分区数\ntable_open_cache=30000 #设置打开表的数量\n\n#perf special\ninnodb_flush_neighbors=0 #检测该页所在区(extent)的所有页，如果是脏页，那么一起进行刷新，SSD关闭该功能\ninnodb_write_io_threads=16 #设置写线程数\ninnodb_read_io_threads=16 #设置读线程数\ninnodb_purge_threads=32 #设置回收已经使用并分配的undo页线程数\ninnodb_adaptive_hash_index=0\n\nsql_mode=STRICT_TRANS_TABLES,NO_ENGINE_SUBSTITUTION,NO_AUTO_VALUE_ON_ZERO,STRICT_ALL_TABLES\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20241120034239-hyzgcy8","Type":"NodeTable","TableAligns":[0,0,0],"Properties":{"colgroup":"||","id":"20241120034239-hyzgcy8","updated":"20241120034239"},"Children":[{"Type":"NodeTableHead","Data":"thead","Children":[{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeText","Data":"参数名称"}]},{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeText","Data":"参数含义"}]},{"Type":"NodeTableCell","Data":"th","Children":[{"Type":"NodeText","Data":"优化建议"}]}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"innodb"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"_"}]},{"Type":"NodeText","Data":"thread"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"_"}]},{"Type":"NodeText","Data":"concurrency"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"InnoDB使用操作系统线程来处理用户的事务请求。"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"建议取默认值为0，它表示默认情况下不限制线程并发执行的数量。"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"innodb"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"_"}]},{"Type":"NodeText","Data":"read"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"_"}]},{"Type":"NodeText","Data":"io"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"_"}]},{"Type":"NodeText","Data":"threads"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"执行请求队列中的读请求操作的线程数。"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"根据CPU核数及读写比例进一步更改来提高性能。"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"innodb"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"_"}]},{"Type":"NodeText","Data":"write"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"_"}]},{"Type":"NodeText","Data":"io"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"_"}]},{"Type":"NodeText","Data":"threads"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"执行请求队列中的写请求操作的线程数。"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"根据CPU核数及读写比例进一步更改来提高性能。"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"innodb"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"_"}]},{"Type":"NodeText","Data":"buffer"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"_"}]},{"Type":"NodeText","Data":"pool"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"_"}]},{"Type":"NodeText","Data":"instances"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"开启多个内存缓冲池，把需要缓冲的数据hash到不同的缓冲池中，这样可以并行的内存读写"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"建议设置8~32。"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"innodb"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"_"}]},{"Type":"NodeText","Data":"open"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"_"}]},{"Type":"NodeText","Data":"files"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"在innodb"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"_"}]},{"Type":"NodeText","Data":"file"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"_"}]},{"Type":"NodeText","Data":"per"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"_"}]},{"Type":"NodeText","Data":"table模式下，限制Innodb能打开的文件数量。"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"建议此值调大一些，尤其是表特别多的情况。"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"innodb"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"_"}]},{"Type":"NodeText","Data":"buffer"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"_"}]},{"Type":"NodeText","Data":"pool"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"_"}]},{"Type":"NodeText","Data":"size"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"缓存数据和索引的地方。"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"通常建议内存的60%左右。"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"innodb"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"_"}]},{"Type":"NodeText","Data":"log"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"_"}]},{"Type":"NodeText","Data":"buffer"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"_"}]},{"Type":"NodeText","Data":"size"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"缓存重做日志。"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"默认值是64M，建议通过查看innodb"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"_"}]},{"Type":"NodeText","Data":"log"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"_"}]},{"Type":"NodeText","Data":"wait，调整innodb"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"_"}]},{"Type":"NodeText","Data":"log"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"_"}]},{"Type":"NodeText","Data":"buffer"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"_"}]},{"Type":"NodeText","Data":"size大小。"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"innodb"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"_"}]},{"Type":"NodeText","Data":"io"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"_"}]},{"Type":"NodeText","Data":"capacity"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"innodb 后台线程每秒最大iops上限。"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"建议为IO QPS总能力的75%。"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"innodb"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"_"}]},{"Type":"NodeText","Data":"log"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"_"}]},{"Type":"NodeText","Data":"files"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"_"}]},{"Type":"NodeText","Data":"in"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"_"}]},{"Type":"NodeText","Data":"group"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"重做日志组的个数。"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"-"}]}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"innodb"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"_"}]},{"Type":"NodeText","Data":"log"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"_"}]},{"Type":"NodeText","Data":"file"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"_"}]},{"Type":"NodeText","Data":"size"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"重做日志文件大小。"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"如果存在大量写操作，建议增加日志文件大小，但日志文件过大，会影响数据恢复时间。 如果是非生产环境，测试极限性能时，尽量调大日志文件。 如果是商用场景，需要考虑数据恢复时间，综合折中后设置日志文件大小。"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"innodb"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"_"}]},{"Type":"NodeText","Data":"flush"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"_"}]},{"Type":"NodeText","Data":"method"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"Log和数据刷新磁盘的方法： datasync模式：写数据时，write这一步并不需要真正写到磁盘才算完成（可能写入到操作系统buffer中就会返回完成），真正完成是flush操作，buffer交给操作系统去flush,并且文件的元数据信息也都需要更新到磁盘。 O"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"_"}]},{"Type":"NodeText","Data":"DSYNC模式：写日志操作是在write这步完成，而数据文件的写入是在flush这步通过fsync完成。 O"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"_"}]},{"Type":"NodeText","Data":"DIRECT模式：数据文件的写入操作是直接从mysql innodb buffer到磁盘的，并不用通过操作系统的缓冲，而真正的完成也是在flush这步,日志还是要经过OS缓冲。"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"建议O"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"_"}]},{"Type":"NodeText","Data":"DIRECT模式。"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"innodb"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"_"}]},{"Type":"NodeText","Data":"spin"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"_"}]},{"Type":"NodeText","Data":"wait"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"_"}]},{"Type":"NodeText","Data":"delay"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"控制轮询的间隔。"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"根据真实场景调试，直到看不到spin"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"_"}]},{"Type":"NodeText","Data":"lock热点函数等。优化建议180。"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"innodb"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"_"}]},{"Type":"NodeText","Data":"sync"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"_"}]},{"Type":"NodeText","Data":"spin"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"_"}]},{"Type":"NodeText","Data":"loops"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"控制轮询的循环次数。"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"根据真实场景调试，直到看不到spin"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"_"}]},{"Type":"NodeText","Data":"lock热点函数等。优化建议25。"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"innodb"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"_"}]},{"Type":"NodeText","Data":"spin"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"_"}]},{"Type":"NodeText","Data":"wait"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"_"}]},{"Type":"NodeText","Data":"pause"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"_"}]},{"Type":"NodeText","Data":"multiplier"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"控制轮询间隔随机数。"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"根据真实场景调试，直到看不到spin"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"_"}]},{"Type":"NodeText","Data":"lock热点函数等。默认值50，优化建议25-50。"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"innodb"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"_"}]},{"Type":"NodeText","Data":"lru"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"_"}]},{"Type":"NodeText","Data":"scan"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"_"}]},{"Type":"NodeText","Data":"depth"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"LRU列表的可用页数量。"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"默认值是1024，非生产环境，测试极限性能可以适当调大，减少checkpoint次数。"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"innodb"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"_"}]},{"Type":"NodeText","Data":"page"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"_"}]},{"Type":"NodeText","Data":"cleaners"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"刷新脏数据的线程数。"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"建议与innodb"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"_"}]},{"Type":"NodeText","Data":"buffer"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"_"}]},{"Type":"NodeText","Data":"pool"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"_"}]},{"Type":"NodeText","Data":"instances相等。"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"innodb"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"_"}]},{"Type":"NodeText","Data":"purge"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"_"}]},{"Type":"NodeText","Data":"threads"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"回收undo的线程数。"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"-"}]}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"innodb"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"_"}]},{"Type":"NodeText","Data":"flush"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"_"}]},{"Type":"NodeText","Data":"log"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"_"}]},{"Type":"NodeText","Data":"at"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"_"}]},{"Type":"NodeText","Data":"trx"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"_"}]},{"Type":"NodeText","Data":"commit"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"不管有没有提交，每秒钟都写到binlog日志里. 每次提交事务，都会把log buffer的内容写到磁盘里去，对日志文件做到磁盘刷新，安全性最好。 每次提交事务，都写到操作系统缓存，由OS刷新到磁盘，性能最好。"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"非生产环境，测试极限性能，可以设置为0。"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"innodb"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"_"}]},{"Type":"NodeText","Data":"doublewrite"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"是否开启二次写。"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"非生产环境，测试极限性能，可以设置为0，关闭二次写。"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"ssl"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"是否开启安全连接。"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"安全连接对性能影响较大，非生产环境，测试极限性能，可以设置为0，商用场景，根据客户需求调整。"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"table"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"_"}]},{"Type":"NodeText","Data":"open"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"_"}]},{"Type":"NodeText","Data":"cache"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"_"}]},{"Type":"NodeText","Data":"instances"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"MySQL 缓存 table 句柄的分区的个数。"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"建议设置16-32。"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"table"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"_"}]},{"Type":"NodeText","Data":"open"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"_"}]},{"Type":"NodeText","Data":"cache"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"Mysqld打开表的数量。"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"建议设置成30000。"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"skip"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"_"}]},{"Type":"NodeText","Data":"log"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"_"}]},{"Type":"NodeText","Data":"bin"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"是否开启binlog。"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"非生产环境，测试极限性能在参数文件中增加此参数，关闭binlog选项（添加至配置文件中： skip"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"_"}]},{"Type":"NodeText","Data":"log"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"_"}]},{"Type":"NodeText","Data":"bin #log-bin=mysql-bin）。"}]}]},{"Type":"NodeTableRow","Data":"tr","Children":[{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"performance"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"_"}]},{"Type":"NodeText","Data":"schema"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"是否开启性能模式。"}]},{"Type":"NodeTableCell","Data":"td","Children":[{"Type":"NodeText","Data":"非生产环境，测试极限性能设置为OFF，关闭性能模式。"}]}]}]},{"ID":"20241120032113-co6zhg8","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20241120032113-co6zhg8","updated":"20241120034840"},"Children":[{"Type":"NodeText","Data":"底层优化"}]},{"ID":"20241120032121-giz13dt","Type":"NodeParagraph","Properties":{"id":"20241120032121-giz13dt","updated":"20241120034016"},"Children":[{"Type":"NodeText","Data":"在Mysql部署在专用服务器时，操作系统很多为其他任务设计的特性是没有意义的，可以通过设置调优使其专用于Mysql。在操作系统层面、CPU层面进行优化。"}]},{"ID":"20241120032231-hryaxwb","Type":"NodeParagraph","Properties":{"id":"20241120032231-hryaxwb","updated":"20241120034840"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"https://syc-test111.oss-cn-chengdu.aliyuncs.com/image-20241120032231-rxek67p.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20241120032250-u4flhym","Type":"NodeParagraph","Properties":{"id":"20241120032250-u4flhym","updated":"20241120032941"},"Children":[{"Type":"NodeText","Data":"可以看这篇 "},{"Type":"NodeTextMark","TextMarkType":"a","TextMarkAHref":"https://docs.openeuler.org/zh/docs/22.09/docs/SystemOptimization/MySQL%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98%E6%8C%87%E5%8D%97.html","TextMarkTextContent":"OpenEuler的文档"},{"Type":"NodeText","Data":" 讲得很好"}]},{"ID":"20241120032928-18rcqsj","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20241120032928-18rcqsj","updated":"20241120033530"},"Children":[{"Type":"NodeText","Data":"网卡中断绑核"}]},{"ID":"20241120033109-7jficnq","Type":"NodeParagraph","Properties":{"id":"20241120033109-7jficnq","updated":"20241120033115"},"Children":[{"Type":"NodeText","Data":"通过关闭irqbalance服务，使用手动绑定网卡中断到部分专用核上，隔离网卡中断请求和业务请求，可以有效提升系统的网络性能。"}]},{"ID":"20241120033137-cdxdb31","Type":"NodeParagraph","Properties":{"id":"20241120033137-cdxdb31","updated":"20241120033233"},"Children":[{"Type":"NodeText","Data":"在这种情况下，CPU其他核心就不用去访问那几个负责网卡中断的核心的内存，因此可以限定NUMA范围为剩余其他核心。"}]},{"ID":"20241120033530-ebxzcvu","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20241120033530-ebxzcvu","updated":"20241120033905"},"Children":[{"Type":"NodeText","Data":"缺页中断调优"}]},{"ID":"20241120033540-910ha1s","Type":"NodeParagraph","Properties":{"id":"20241120033540-910ha1s","updated":"20241120033802"},"Children":[{"Type":"NodeText","Data":"使缺页中断尽可能命中快表可以提升性能，因此可以选择将页面大小调大，可以有效提高命中率。在这种场景下，内存消耗是不敏感的，因此大页带来的内存碎片其实不是非常重要。"}]},{"ID":"20241120033845-bj430ov","Type":"NodeParagraph","Properties":{"id":"20241120033845-bj430ov","updated":"20241120033845"},"Children":[{"Type":"NodeText","Data":"通过命令getconf PAGESIZE查看当前系统的内存页大小，如果大小是4096(4K)，则可通过修改linux内核的内存页大小来使用更大的内存页，需要在修改内核编译选项后重新编译内核。简要步骤如下："}]},{"ID":"20241120033849-3sj82ap","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20241120033849-3sj82ap","updated":"20241120034022"},"Children":[{"Type":"NodeText","Data":"使用用户态网络协议栈"}]},{"ID":"20241120033919-fiyue6o","Type":"NodeParagraph","Properties":{"id":"20241120033919-fiyue6o","updated":"20241120034022"},"Children":[{"Type":"NodeText","Data":"原生内核网络协议栈层次深，开销较大，且系统调用的成本也较高。通过gazelle用户态协议栈替代内核协议栈，且通过hook posix接口，避免系统调用带来的开销，能够大幅提高应用的网络I/O吞吐能力。"}]}]}