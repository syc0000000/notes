{"ID":"20241121022142-vtija1k","Spec":"1","Type":"NodeDocument","Properties":{"custom-custom-Haloweb-yaml":"---_esc_newline_created: '2024-11-21 02:21:42'_esc_newline_updated: '2025-04-20 14:28:08'_esc_newline_title: MySQL索引失效常见原因分析_esc_newline_slug: mysql-index-z2gxg5t_esc_newline_permalink: siyuan://blocks/20241121022142-vtija1k_esc_newline_desc: \u0026gt;-_esc_newline_  本文总结了MySQL索引失效的常见场景，包括最左匹配原则失效、使用函数或计算、类型不匹配、不等式操作、使用OR、IS NULL、IN、LIKE_esc_newline_  '%...'、NOT IN、NOT EXISTS、强制类型转换、ORDER BY和GROUP_esc_newline_  BY、子查询、不等式和等式混合条件等。同时，文章还解释了联合索引的最左匹配原则以及回表查询与索引下推的概念。_esc_newline_tags:_esc_newline_  - 面经_esc_newline_categories: []_esc_newline_---","id":"20241121022142-vtija1k","tags":"面经","title":"MySQL索引失效常见原因分析","type":"doc","updated":"20250420142756"},"Children":[{"ID":"20241121022647-qb31a2v","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20241121022647-qb31a2v","updated":"20241121022652"},"Children":[{"Type":"NodeText","Data":"索引失效"}]},{"ID":"20241121022625-kgops0f","Type":"NodeParagraph","Properties":{"id":"20241121022625-kgops0f","updated":"20241121022635"},"Children":[{"Type":"NodeText","Data":"根据"},{"Type":"NodeTextMark","TextMarkType":"a","TextMarkAHref":"https://mp.weixin.qq.com/s/mwME3qukHBFul57WQLkOYg","TextMarkTextContent":"文章"}]},{"ID":"20241121022142-2yxls4b","Type":"NodeParagraph","Properties":{"id":"20241121022142-2yxls4b","updated":"20241121022522"},"Children":[{"Type":"NodeText","Data":"索引失效场景总结："}]},{"ID":"20241121022550-yn6ch7p","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20241121022550-yn6ch7p","updated":"20241121022550"},"Children":[{"ID":"20241121022550-h7hocjv","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"MS4=","Num":1},"Properties":{"id":"20241121022550-h7hocjv","updated":"20241121022550"},"Children":[{"ID":"20241121022550-e70q94a","Type":"NodeParagraph","Properties":{"id":"20241121022550-e70q94a","updated":"20241121022550"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"最左匹配原则失效"},{"Type":"NodeText","Data":"：在使用联合索引时，如果查询条件没有遵循索引的最左前缀规则，即没有从索引的最左边列开始匹配，索引将不会生效。"}]}]},{"ID":"20241121022550-8dcri4l","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"Mi4=","Num":2},"Properties":{"id":"20241121022550-8dcri4l","updated":"20241121022550"},"Children":[{"ID":"20241121022550-e5vt8yh","Type":"NodeParagraph","Properties":{"id":"20241121022550-e5vt8yh","updated":"20241121022550"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"使用函数或计算导致索引失效"},{"Type":"NodeText","Data":"：对索引列使用函数或进行计算操作时，索引将失效，因为索引存储的是列的原始值。"}]}]},{"ID":"20241121022550-44oa8j9","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"My4=","Num":3},"Properties":{"id":"20241121022550-44oa8j9","updated":"20241121022550"},"Children":[{"ID":"20241121022550-uqn3pb7","Type":"NodeParagraph","Properties":{"id":"20241121022550-uqn3pb7","updated":"20241121022550"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"类型不匹配导致索引失效"},{"Type":"NodeText","Data":"：如果查询条件中的数据类型与索引列的类型不一致，可能会导致索引失效。"}]}]},{"ID":"20241121022550-1cfuxbo","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"NC4=","Num":4},"Properties":{"id":"20241121022550-1cfuxbo","updated":"20241121022550"},"Children":[{"ID":"20241121022550-ltbmxu6","Type":"NodeParagraph","Properties":{"id":"20241121022550-ltbmxu6","updated":"20241121022550"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"使用了不等式操作导致索引失效"},{"Type":"NodeText","Data":"：使用"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"\u003c"}]},{"Type":"NodeText","Data":"、"},{"Type":"NodeBackslash","Data":"span","Children":[{"Type":"NodeText","Data":"\u003e"}]},{"Type":"NodeText","Data":"等不等式操作符时，可能会导致索引失效，尤其是当它们出现在查询的最前面时。"}]}]},{"ID":"20241121022550-hbs58gn","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"NS4=","Num":5},"Properties":{"id":"20241121022550-hbs58gn","updated":"20241121022550"},"Children":[{"ID":"20241121022550-oevvm92","Type":"NodeParagraph","Properties":{"id":"20241121022550-oevvm92","updated":"20241121022550"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"使用了OR导致索引失效"},{"Type":"NodeText","Data":"：在查询条件中使用了OR，且OR前后的字段不是同一个索引的列时，可能会导致索引失效。"}]}]},{"ID":"20241121022550-k87vqzg","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"Ni4=","Num":6},"Properties":{"id":"20241121022550-k87vqzg","updated":"20241121022550"},"Children":[{"ID":"20241121022550-0duymgh","Type":"NodeParagraph","Properties":{"id":"20241121022550-0duymgh","updated":"20241121022550"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"使用了IS NULL导致索引失效"},{"Type":"NodeText","Data":"：对索引列使用IS NULL条件时，可能会导致索引失效。"}]}]},{"ID":"20241121022550-x7wu69f","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"Ny4=","Num":7},"Properties":{"id":"20241121022550-x7wu69f","updated":"20241121022550"},"Children":[{"ID":"20241121022550-m9fe093","Type":"NodeParagraph","Properties":{"id":"20241121022550-m9fe093","updated":"20241121022550"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"使用了IN导致索引失效"},{"Type":"NodeText","Data":"：当IN子句中的值较多时，可能会导致索引失效，因为MySQL可能认为全表扫描比使用索引更快。"}]}]},{"ID":"20241121022550-jvshul1","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"OC4=","Num":8},"Properties":{"id":"20241121022550-jvshul1","updated":"20241121022550"},"Children":[{"ID":"20241121022550-2nhnuwe","Type":"NodeParagraph","Properties":{"id":"20241121022550-2nhnuwe","updated":"20241121022550"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"使用了LIKE '%...'导致索引失效"},{"Type":"NodeText","Data":"：使用LIKE进行模糊查询时，如果模式以百分号开头，索引将失效。"}]}]},{"ID":"20241121022550-61wzk57","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"OS4=","Num":9},"Properties":{"id":"20241121022550-61wzk57","updated":"20241121022550"},"Children":[{"ID":"20241121022550-u2ys2dp","Type":"NodeParagraph","Properties":{"id":"20241121022550-u2ys2dp","updated":"20241121022550"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"使用了NOT IN导致索引失效"},{"Type":"NodeText","Data":"：使用NOT IN时，可能会导致索引失效，因为MySQL可能认为全表扫描比使用索引更快。"}]}]},{"ID":"20241121022550-dkuzxkw","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"MTAu","Num":10},"Properties":{"id":"20241121022550-dkuzxkw","updated":"20241121022550"},"Children":[{"ID":"20241121022550-fbis46a","Type":"NodeParagraph","Properties":{"id":"20241121022550-fbis46a","updated":"20241121022550"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"使用了NOT EXISTS导致索引失效"},{"Type":"NodeText","Data":"：使用NOT EXISTS时，可能会导致索引失效，因为MySQL可能认为全表扫描比使用索引更快。"}]}]},{"ID":"20241121022550-c2gha96","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"MTEu","Num":11},"Properties":{"id":"20241121022550-c2gha96","updated":"20241121022550"},"Children":[{"ID":"20241121022550-pd822ai","Type":"NodeParagraph","Properties":{"id":"20241121022550-pd822ai","updated":"20241121022550"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"强制类型转换导致索引失效"},{"Type":"NodeText","Data":"：查询条件中的数据类型与索引列的数据类型不一致，导致MySQL进行强制类型转换，从而使索引失效。"}]}]},{"ID":"20241121022550-5m1r2bp","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"MTIu","Num":12},"Properties":{"id":"20241121022550-5m1r2bp","updated":"20241121022550"},"Children":[{"ID":"20241121022550-gub3ryh","Type":"NodeParagraph","Properties":{"id":"20241121022550-gub3ryh","updated":"20241121022550"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"使用了ORDER BY和GROUP BY导致索引失效"},{"Type":"NodeText","Data":"：在排序和分组操作中，MySQL可能认为全表扫描比回表排序更快，导致索引失效。"}]}]},{"ID":"20241121022550-3hra03d","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"MTMu","Num":13},"Properties":{"id":"20241121022550-3hra03d","updated":"20241121022550"},"Children":[{"ID":"20241121022550-d5bmpg6","Type":"NodeParagraph","Properties":{"id":"20241121022550-d5bmpg6","updated":"20241121022550"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"使用了子查询导致索引失效"},{"Type":"NodeText","Data":"：在某些情况下，子查询可能不使用外部查询的索引。"}]}]},{"ID":"20241121022550-j9uckz3","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"MTQu","Num":14},"Properties":{"id":"20241121022550-j9uckz3","updated":"20241121022550"},"Children":[{"ID":"20241121022550-ajwkfcs","Type":"NodeParagraph","Properties":{"id":"20241121022550-ajwkfcs","updated":"20241121022550"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"使用了不等式和等式混合条件导致索引失效"},{"Type":"NodeText","Data":"：在查询条件中混合使用不等式和等式条件时，可能会导致索引失效。"}]}]}]},{"ID":"20241121022551-1hjef4m","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20241121022551-1hjef4m","updated":"20241121023116"},"Children":[{"Type":"NodeText","Data":"联合索引最左匹配"}]},{"ID":"20241121023009-e5ts3jr","Type":"NodeParagraph","Properties":{"id":"20241121023009-e5ts3jr","updated":"20241121023013"},"Children":[{"Type":"NodeText","Data":"最左前缀匹配原则指的是在使用联合索引时，MySQL 会根据索引中的字段顺序，从左到右依次匹配查询条件中的字段。如果查询条件与索引中的最左侧字段相匹配，那么 MySQL 就会使用索引来过滤数据，这样可以提高查询效率。"}]},{"ID":"20241121023026-ogi0pci","Type":"NodeParagraph","Properties":{"id":"20241121023026-ogi0pci","updated":"20241121023028"},"Children":[{"Type":"NodeText","Data":"假设有一个联合索引"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"(column1, column2, column3)"},{"Type":"NodeText","Data":"​，其从左到右的所有前缀为"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"(column1)"},{"Type":"NodeText","Data":"​、"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"(column1, column2)"},{"Type":"NodeText","Data":"​、"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"(column1, column2, column3)"},{"Type":"NodeText","Data":"​（创建 1 个联合索引相当于创建了 3 个索引），包含这些列的所有查询都会走索引而不会全表扫描。"}]},{"ID":"20241121023032-omqz6e8","Type":"NodeParagraph","Properties":{"id":"20241121023032-omqz6e8","updated":"20241121023104"},"Children":[{"Type":"NodeText","Data":"如果有索引 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"联合索引（a，b，c）"},{"Type":"NodeText","Data":"​，查询 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"a=1 AND c=1"},{"Type":"NodeText","Data":"​会走索引么？"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"c=1"},{"Type":"NodeText","Data":"​ 呢？"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"b=1 AND c=1"},{"Type":"NodeText","Data":"​呢？"}]},{"ID":"20241121023115-35vd4ng","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20241121023115-35vd4ng","updated":"20241121023115"},"Children":[{"ID":"20241121023115-mstqu1b","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"MS4=","Num":1},"Properties":{"id":"20241121023115-mstqu1b","updated":"20241121023115"},"Children":[{"ID":"20241121023115-6b72yaf","Type":"NodeParagraph","Properties":{"id":"20241121023115-6b72yaf","updated":"20241121023115"},"Children":[{"Type":"NodeText","Data":"查询 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"a=1 AND c=1"},{"Type":"NodeText","Data":"​：根据最左前缀匹配原则，查询可以使用索引的前缀部分。因此，该查询仅在 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"a=1"},{"Type":"NodeText","Data":"​ 上使用索引，然后对结果进行 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"c=1"},{"Type":"NodeText","Data":"​ 的过滤。"}]}]},{"ID":"20241121023115-c5n6741","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"Mi4=","Num":2},"Properties":{"id":"20241121023115-c5n6741","updated":"20241121023115"},"Children":[{"ID":"20241121023115-c59zwu5","Type":"NodeParagraph","Properties":{"id":"20241121023115-c59zwu5","updated":"20241121023115"},"Children":[{"Type":"NodeText","Data":"查询 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"c=1"},{"Type":"NodeText","Data":"​ ：由于查询中不包含最左列 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"a"},{"Type":"NodeText","Data":"​，根据最左前缀匹配原则，整个索引都无法被使用。"}]}]},{"ID":"20241121023115-czsqc6t","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"My4=","Num":3},"Properties":{"id":"20241121023115-czsqc6t","updated":"20241121023115"},"Children":[{"ID":"20241121023115-7v6txj7","Type":"NodeParagraph","Properties":{"id":"20241121023115-7v6txj7","updated":"20241121023115"},"Children":[{"Type":"NodeText","Data":"查询"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"b=1 AND c=1"},{"Type":"NodeText","Data":"​：和第二种一样的情况，整个索引都不会使用。"}]}]}]},{"ID":"20241121023116-rvbsrei","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20241121023116-rvbsrei","updated":"20241121023242"},"Children":[{"Type":"NodeText","Data":"回表查询与索引下推"}]},{"ID":"20241121023242-zipajhq","Type":"NodeParagraph","Properties":{"id":"20241121023242-zipajhq","updated":"20241121023242"}}]}