{"ID":"20240923114714-v5kck13","Spec":"1","Type":"NodeDocument","Properties":{"custom-common-Halo-yaml":"---_esc_newline_created: '2024-09-23 11:47:14'_esc_newline_updated: '2024-09-23 12:32:04'_esc_newline_title: 雪花ID_esc_newline_slug: snowflake-id-z1diiuq_esc_newline_permalink: siyuan://blocks/20240923114714-v5kck13_esc_newline_tags:_esc_newline_  - 招新平台设计_esc_newline_categories: []_esc_newline_---","custom-picgo-file-map-key":"\u0026#123;\u0026quot;fe29f2467cac72bc35e1f7f6e10b461f\u0026quot;:\u0026#123;\u0026quot;name\u0026quot;:\u0026quot;image-20240923122011-c21idu6.png\u0026quot;,\u0026quot;hash\u0026quot;:\u0026quot;fe29f2467cac72bc35e1f7f6e10b461f\u0026quot;,\u0026quot;originUrl\u0026quot;:\u0026quot;assets/image-20240923122011-c21idu6.png\u0026quot;,\u0026quot;url\u0026quot;:\u0026quot;https://syc-test111.oss-cn-chengdu.aliyuncs.com/image-20240923122011-c21idu6.png\u0026quot;,\u0026quot;alt\u0026quot;:\u0026quot;image\u0026quot;,\u0026quot;title\u0026quot;:\u0026quot;\u0026quot;,\u0026quot;isLocal\u0026quot;:false,\u0026quot;blockId\u0026quot;:\u0026quot;20240923122011-7d7jyb6\u0026quot;\u0026#125;\u0026#125;","id":"20240923114714-v5kck13","tags":"招新平台设计","title":"雪花ID","type":"doc","updated":"20240923130726"},"Children":[{"ID":"20240923114714-wy405bg","Type":"NodeParagraph","Properties":{"id":"20240923114714-wy405bg","updated":"20240923121830"},"Children":[{"Type":"NodeText","Data":"在复杂"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"分布式系统"},{"Type":"NodeText","Data":"中，往往需要对大量的数据和消息进行唯一标识。如在美团点评支付系统中，数据日渐增长，对数据分库分表后需要有一个唯一 ID 来标识一条数据或消息，数据库的自增 ID 显然不能满足需求；特别一点的如订单、骑手、优惠券也都需要有唯一 ID 做标识。"}]},{"ID":"20240923121727-vsjhbn2","Type":"NodeParagraph","Properties":{"id":"20240923121727-vsjhbn2","updated":"20240923121841"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"全局唯一 ID 应当具备什么样的属性，才能够满足上述的场景呢？"},{"Type":"NodeText","Data":"美团技术团队列出的 4 点属性我觉得很准确，它们是："}]},{"ID":"20240923121732-v9ywt7c","Type":"NodeList","ListData":{},"Properties":{"id":"20240923121732-v9ywt7c","updated":"20240923121732"},"Children":[{"ID":"20240923121732-6dvjxo2","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240923121732-6dvjxo2","updated":"20240923121732"},"Children":[{"ID":"20240923121727-xc512f7","Type":"NodeParagraph","Properties":{"id":"20240923121727-xc512f7","updated":"20240923121734"},"Children":[{"Type":"NodeText","Data":"全局唯一性：不能出现重复的 ID 号，既然是唯一标识，这是最基本的要求；"}]}]},{"ID":"20240923121734-fzc5iyb","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240923121734-fzc5iyb","updated":"20240923121734"},"Children":[{"ID":"20240923121734-26chzb2","Type":"NodeParagraph","Properties":{"id":"20240923121734-26chzb2","updated":"20240923121738"},"Children":[{"Type":"NodeText","Data":"趋势递增：在 MySQL InnoDB 引擎中使用的是聚集索引，由于多数 RDBMS 使用 B-tree 的数据结构来存储索引数据，在主键的选择上面我们应该尽量使用有序的主键保证写入性能；"}]}]},{"ID":"20240923121738-9fj7s5h","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240923121738-9fj7s5h","updated":"20240923121738"},"Children":[{"ID":"20240923121738-3atd7jx","Type":"NodeParagraph","Properties":{"id":"20240923121738-3atd7jx","updated":"20240923121739"},"Children":[{"Type":"NodeText","Data":"单调递增：保证下一个 ID 一定大于上一个 ID，例如事务版本号、IM 增量消息、排序等特殊需求；"}]}]},{"ID":"20240923121740-fx58g5c","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240923121740-fx58g5c","updated":"20240923121740"},"Children":[{"ID":"20240923121740-4xtuv07","Type":"NodeParagraph","Properties":{"id":"20240923121740-4xtuv07","updated":"20240923121740"},"Children":[{"Type":"NodeText","Data":"信息安全：如果 ID 是连续的，恶意用户的爬取工作就非常容易做了，直接按照顺序下载指定 URL 即可；如果是订单号就更危险了，竞争对手可以直接知道我们一天的单量。所以在一些应用场景下，会需要 ID 无规则、不规则。"}]}]}]},{"ID":"20240923121744-2v2u7kw","Type":"NodeParagraph","Properties":{"id":"20240923121744-2v2u7kw","updated":"20240923121803"},"Children":[{"Type":"NodeText","Data":"除了以上列举的 ID 属性外，基于这个生成算法构建的服务还需要买足高 QPS、高可用性和低延迟的几个要求。"}]},{"ID":"20240923121807-fm1nk66","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240923121807-fm1nk66","updated":"20240923123207"},"Children":[{"Type":"NodeText","Data":"Twitter开源方案 Snowflake"}]},{"ID":"20240923121944-sg5blts","Type":"NodeParagraph","Properties":{"id":"20240923121944-sg5blts","updated":"20240923122045"},"Children":[{"Type":"NodeText","Data":"Twitter 于 2010 年开源了内部团队在用的一款全局唯一 ID 生成算法 Snowflake，翻译过来叫做雪花算法。Snowflake 不借助数据库，可直接由编程语言生成。Snowflake组成如下："}]},{"ID":"20240923122011-7d7jyb6","Type":"NodeParagraph","Properties":{"id":"20240923122011-7d7jyb6","updated":"20240923123207"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"https://syc-test111.oss-cn-chengdu.aliyuncs.com/image-20240923122011-c21idu6.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20240923122054-orcj1be","Type":"NodeList","ListData":{},"Properties":{"id":"20240923122054-orcj1be","updated":"20240923122100"},"Children":[{"ID":"20240923122100-8hg6kiz","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240923122100-8hg6kiz","updated":"20240923122100"},"Children":[{"ID":"20240923122100-ei43p7n","Type":"NodeParagraph","Properties":{"id":"20240923122100-ei43p7n","updated":"20240923122100"},"Children":[{"Type":"NodeText","Data":"最高位占1 bit，值固定为 0，以保证生成的 ID 为正数；"}]}]},{"ID":"20240923122109-7nesmmv","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240923122109-7nesmmv","updated":"20240923122109"},"Children":[{"ID":"20240923122109-245dlpz","Type":"NodeParagraph","Properties":{"id":"20240923122109-245dlpz","updated":"20240923122109"},"Children":[{"Type":"NodeText","Data":"中位占 41 bit，值为毫秒级时间戳；"}]}]},{"ID":"20240923122111-mz4og5j","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240923122111-mz4og5j","updated":"20240923122111"},"Children":[{"ID":"20240923122111-2kh4bao","Type":"NodeParagraph","Properties":{"id":"20240923122111-2kh4bao","updated":"20240923122111"},"Children":[{"Type":"NodeText","Data":"中下位占 10 bit，值为工作机器的 ID，值的上限为 1024；"}]}]},{"ID":"20240923122114-64th61i","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240923122114-64th61i","updated":"20240923122114"},"Children":[{"ID":"20240923122114-vbpq82j","Type":"NodeParagraph","Properties":{"id":"20240923122114-vbpq82j","updated":"20240923122114"},"Children":[{"Type":"NodeText","Data":"末位占 12 bit，值为当前毫秒内生成的不同 ID，值的上限为 4096；"}]}]}]},{"ID":"20240923122117-2t2sr4m","Type":"NodeParagraph","Properties":{"id":"20240923122117-2t2sr4m","updated":"20240923122226"},"Children":[{"Type":"NodeText","Data":"snowflake 不依赖数据库，也不依赖内存存储，随时可生成 ID，这也是它如此受欢迎的原因。但因为它在设计时通过时间戳来避免对内存和数据库的依赖，所以它依赖于"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"服务器的时间"},{"Type":"NodeText","Data":"。"}]},{"ID":"20240923122228-3685dpz","Type":"NodeParagraph","Properties":{"id":"20240923122228-3685dpz","updated":"20240923122953"},"Children":[{"Type":"NodeText","Data":"但如果服务器的时间发生了错乱或者回拨，这就直接影响到生成的 ID，有很大概率生成重复的 ID 且一定会打破递增属性。"}]},{"ID":"20240923122212-pp0uyip","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240923122212-pp0uyip","updated":"20240923130726"},"Children":[{"Type":"NodeText","Data":"美团技术方案 Leaf"}]},{"ID":"20240923123148-hp3lxad","Type":"NodeParagraph","Properties":{"id":"20240923123148-hp3lxad","updated":"20240923123200"},"Children":[{"Type":"NodeText","Data":"暂时没有理解，先放着"}]},{"ID":"20240923123118-6e322yh","Type":"NodeParagraph","Properties":{"id":"20240923123118-6e322yh","updated":"20240923123144"},"Children":[{"Type":"NodeText","Data":"在线链接："},{"Type":"NodeTextMark","TextMarkType":"a","TextMarkAHref":"https://tech.meituan.com/2017/04/21/mt-leaf.html","TextMarkTextContent":"https://tech.meituan.com/2017/04/21/mt-leaf.html"}]}]}