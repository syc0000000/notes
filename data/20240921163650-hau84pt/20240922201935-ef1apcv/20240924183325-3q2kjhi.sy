{"ID":"20240924183325-3q2kjhi","Spec":"1","Type":"NodeDocument","Properties":{"custom-common-Halo-yaml":"---_esc_newline_created: '2024-09-24 18:33:25'_esc_newline_updated: '2024-10-08 21:55:57'_esc_newline_title: 简单公告_esc_newline_slug: simple-announcement-2j66er_esc_newline_permalink: siyuan://blocks/20240924183325-3q2kjhi_esc_newline_tags:_esc_newline_  - 招新平台设计_esc_newline_categories: []_esc_newline_---","id":"20240924183325-3q2kjhi","tags":"招新平台设计","title":"简单公告","type":"doc","updated":"20241008215546"},"Children":[{"ID":"20241008211548-zwsy4is","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20241008211548-zwsy4is","updated":"20241008212330"},"Children":[{"Type":"NodeText","Data":"基于客户端的公告实现"}]},{"ID":"20241008211711-lxbcgse","Type":"NodeParagraph","Properties":{"id":"20241008211711-lxbcgse","updated":"20241008211711"},"Children":[{"Type":"NodeText","Data":"招新平台的公告设计确实简单，除了发布、查询、编辑功能以外，对用户的已读/未读状态维护得并不完整，用户的已读状态在客户端保存，通过轮询发送本地已读公告id请求服务端未读id，如果有新未读id，直接显示。"}]},{"ID":"20241008211711-yjansds","Type":"NodeParagraph","Properties":{"id":"20241008211711-yjansds","updated":"20241008211711"},"Children":[{"Type":"NodeText","Data":"在赶进度/人手不足状态下是可理解的，因为从业务角度讲，公告的已读状态属于不重要内容，不用担心丢失或被篡改，因此可以选择放在客户端，但问题是用户更换设备登录/更换浏览器登录就需要重新读一遍公告，体验不好，这里先分析一下招新平台现在的实现方式。"}]},{"ID":"20241008211337-8ols4no","Type":"NodeParagraph","Properties":{"id":"20241008211337-8ols4no","updated":"20241008211807"},"Children":[{"Type":"NodeText","Data":"根据分析，只需要维护：公告的增删改查、根据已读id查询未读id这两大块功能。"}]},{"ID":"20241008211807-7i94mfb","Type":"NodeParagraph","Properties":{"id":"20241008211807-7i94mfb","updated":"20241008211944"},"Children":[{"Type":"NodeText","Data":"增删改查设计较为简单，不再赘述，唯一需要注意的地方是接口鉴权，一定要验证管理员身份再支持公告的修改，否则会出大问题，具体参考"},{"Type":"NodeTextMark","TextMarkType":"block-ref","TextMarkBlockRefID":"20240922202007-jfh49nb","TextMarkBlockRefSubtype":"d","TextMarkTextContent":"RBAC权限管理"},{"Type":"NodeText","Data":"。"}]},{"ID":"20241008211906-8symwm1","Type":"NodeParagraph","Properties":{"id":"20241008211906-8symwm1","updated":"20241008212329"},"Children":[{"Type":"NodeText","Data":"对于根据已读id查询未读id这个功能，需要注意不必查询全部id后再在业务层做排除，可以直接使用数据库提供的不等于功能快速排除。"}]},{"ID":"20241008212330-nbr8chx","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20241008212330-nbr8chx","updated":"20241008215441"},"Children":[{"Type":"NodeText","Data":"正确公告系统的设计"}]},{"ID":"20241008215012-mpua2ix","Type":"NodeParagraph","Properties":{"id":"20241008215012-mpua2ix","updated":"20241008215426"},"Children":[{"Type":"NodeText","Data":"重点在已读/未读状态的维护，个人认为可以分为两种，推和拉。推模式为每个用户维护一个公告已读情况，拉模式为每个公告维护一个已读用户情况，应该根据用户数量和公告数量合理选择。"}]},{"ID":"20241008214952-0iwmp03","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20241008214952-0iwmp03","updated":"20241008215441"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"推模式"}]},{"ID":"20241008211712-canw0dk","Type":"NodeParagraph","Properties":{"id":"20241008211712-canw0dk","updated":"20241008215441"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"Redis bitmap 存储 未读/已读"}]},{"ID":"20241008213654-s52pivt","Type":"NodeParagraph","Properties":{"id":"20241008213654-s52pivt","updated":"20241008214415"},"Children":[{"Type":"NodeText","Data":"首先，其实未读已读就是一个0/1的标记而已，可以维护一个Bitmap来实现，0未读，1已读。但是如果公告id使用"},{"Type":"NodeTextMark","TextMarkType":"block-ref","TextMarkBlockRefID":"20240923114714-v5kck13","TextMarkBlockRefSubtype":"s","TextMarkTextContent":"雪花id"},{"Type":"NodeText","Data":"来实现的话，会出现id过长的问题，因此需要配套为每个公告设置一个自增id。"}]},{"ID":"20241008213921-m84idim","Type":"NodeParagraph","Properties":{"id":"20241008213921-m84idim","updated":"20241008214205"},"Children":[{"Type":"NodeText","Data":"然后，每当用户阅读一个公告，就更新bitmap对应位为1，这样可以方便的识别公告的已读未读情况。"}]},{"ID":"20241008214213-gik3rgg","Type":"NodeParagraph","Properties":{"id":"20241008214213-gik3rgg","updated":"20241008214948"},"Children":[{"Type":"NodeText","Data":"放不下了怎么办？位图搞大点吧。。。。例如搞一个25565位的位图怎么都够了吧。"}]},{"ID":"20241008214859-fm3bmgp","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20241008214859-fm3bmgp","updated":"20241008215546"},"Children":[{"Type":"NodeText","Data":"拉模式"}]},{"ID":"20241008215225-8ht0f59","Type":"NodeParagraph","Properties":{"id":"20241008215225-8ht0f59","updated":"20241008215344"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"Redis bitmap 存储 未读/已读"}]},{"ID":"20241008215225-c7gjlr1","Type":"NodeBlockquote","Properties":{"id":"20241008215225-c7gjlr1","updated":"20241008215400"},"Children":[{"Type":"NodeBlockquoteMarker","Data":"\u003e"},{"ID":"20241008215225-zgtad8t","Type":"NodeList","ListData":{},"Properties":{"id":"20241008215225-zgtad8t","updated":"20241008215225"},"Children":[{"ID":"20241008215223-j8va2fz","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20241008215223-j8va2fz","updated":"20241008215223"},"Children":[{"ID":"20241008215225-6jpvq9j","Type":"NodeParagraph","Properties":{"id":"20241008215225-6jpvq9j","updated":"20241008215225"},"Children":[{"Type":"NodeText","Data":"Redis存储 key为公告id bitmap存已读的用户id"}]}]}]}]},{"ID":"20241008215225-wqacnip","Type":"NodeParagraph","Properties":{"id":"20241008215225-wqacnip","updated":"20241008215246"},"Children":[{"Type":"NodeText","Data":"所有公告分页查询时，先得到Mysql分页第一页的公告id，然后遍历查询Redis已读未读状态"}]},{"ID":"20241008215239-04qgvm0","Type":"NodeParagraph","Properties":{"id":"20241008215239-04qgvm0","updated":"20241008215239"},"Children":[{"Type":"NodeText","Data":"未读公告的分页，需要查询所有的公告id(组织注册时间后的公告)， 遍历请求redis得到 未读的公告id， 再进入Mysql 使用 in 进行分页"}]},{"ID":"20241008215225-hu2pqwj","Type":"NodeList","ListData":{},"Properties":{"id":"20241008215225-hu2pqwj","updated":"20241008215313"},"Children":[{"ID":"20241008215254-gx01gg4","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20241008215254-gx01gg4","updated":"20241008215254"},"Children":[{"ID":"20241008215254-t6kyw8z","Type":"NodeParagraph","Properties":{"id":"20241008215254-t6kyw8z","updated":"20241008215254"},"Children":[{"Type":"NodeText","Data":"优点： 新增公告无需维护关联关系"}]}]},{"ID":"20241008215256-2xvfotx","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20241008215256-2xvfotx","updated":"20241008215313"},"Children":[{"ID":"20241008215256-9up7vnc","Type":"NodeParagraph","Properties":{"id":"20241008215256-9up7vnc","updated":"20241008215256"},"Children":[{"Type":"NodeText","Data":"缺点："}]},{"ID":"20241008215301-iczi8n5","Type":"NodeList","ListData":{},"Properties":{"id":"20241008215301-iczi8n5","updated":"20241008215313"},"Children":[{"ID":"20241008215223-bpv50s2","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20241008215223-bpv50s2","updated":"20241008215302"},"Children":[{"ID":"20241008215225-w7ec2q1","Type":"NodeParagraph","Properties":{"id":"20241008215225-w7ec2q1","updated":"20241008215225"},"Children":[{"Type":"NodeText","Data":"分页查看所有未读的需求会随着公告的增多循环次数会增多"}]}]},{"ID":"20241008215223-hofwl52","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20241008215223-hofwl52","updated":"20241008215313"},"Children":[{"ID":"20241008215225-jcyn8bj","Type":"NodeParagraph","Properties":{"id":"20241008215225-jcyn8bj","updated":"20241008215313"},"Children":[{"Type":"NodeText","Data":"全部已读需要遍历所有公告"}]}]},{"ID":"20241008215223-k9ue16a","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20241008215223-k9ue16a","updated":"20241008215223"},"Children":[{"ID":"20241008215225-u97hk7s","Type":"NodeParagraph","Properties":{"id":"20241008215225-u97hk7s","updated":"20241008215225"},"Children":[{"Type":"NodeText","Data":"随着用户数增多单个key占用的内存持续增长"}]}]}]}]}]},{"ID":"20241008215225-q8ahyav","Type":"NodeParagraph","Properties":{"id":"20241008215225-q8ahyav","updated":"20241008215546"},"Children":[{"Type":"NodeText","Data":"可以通过存储用户最后一次"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"所有公告已读"},{"Type":"NodeText","Data":"的时间戳，减少循环次数"}]},{"ID":"20241008215225-9853lku","Type":"NodeBlockquote","Properties":{"id":"20241008215225-9853lku","updated":"20241008215225"},"Children":[{"Type":"NodeBlockquoteMarker","Data":"\u003e"},{"ID":"20241008215225-6fek18y","Type":"NodeParagraph","Properties":{"id":"20241008215225-6fek18y","updated":"20241008215225"},"Children":[{"Type":"NodeText","Data":"扩展： "},{"Type":"NodeTextMark","TextMarkType":"a","TextMarkAHref":"https://github.com/aviggiano/redis-roaring","TextMarkTextContent":"Redis roaring bitmap"},{"Type":"NodeText","Data":" 降低基数较大时bitmap的存储"}]}]},{"ID":"20241008215527-8dvd1xb","Type":"NodeParagraph","Properties":{"id":"20241008215527-8dvd1xb","updated":"20241008215527"}}]}