{"ID":"20241120002759-6efz0dq","Spec":"1","Type":"NodeDocument","Properties":{"custom-custom-Haloweb-yaml":"---_esc_newline_created: '2024-11-20 00:27:59'_esc_newline_updated: '2025-04-20 21:05:55'_esc_newline_title: 堆基础解析及操作_esc_newline_slug: heap-z1pxatp_esc_newline_permalink: siyuan://blocks/20241120002759-6efz0dq_esc_newline_desc: \u0026gt;-_esc_newline_  本文介绍了堆这种数据结构及其两种类型：小顶堆和大顶堆。堆是一种满足特定条件的完全二叉树，其任意节点的值小于等于（或大于等于）其子节点的值。堆常用于实现优先队列，其入队和出队操作的时间复杂度均为_esc_newline_  O(logn)，建堆操作为 O(n)。文章详细讲解了堆的数组表示、入堆、出堆和建堆等操作，并举例说明了如何利用堆解决 Top-k 问题。_esc_newline_tags:_esc_newline_  - 数据结构_esc_newline_categories: []_esc_newline_---","custom-picgo-file-map-key":"\u0026#123;\u0026quot;e7be4926823cb1af4d606b11a4a27632\u0026quot;:\u0026#123;\u0026quot;name\u0026quot;:\u0026quot;image-20241120020631-gfu3rbn.png\u0026quot;,\u0026quot;hash\u0026quot;:\u0026quot;e7be4926823cb1af4d606b11a4a27632\u0026quot;,\u0026quot;originUrl\u0026quot;:\u0026quot;assets/image-20241120020631-gfu3rbn.png\u0026quot;,\u0026quot;url\u0026quot;:\u0026quot;https://syc-test111.oss-cn-chengdu.aliyuncs.com/image-20241120020631-gfu3rbn.png\u0026quot;,\u0026quot;alt\u0026quot;:\u0026quot;image\u0026quot;,\u0026quot;title\u0026quot;:\u0026quot;\u0026quot;,\u0026quot;isLocal\u0026quot;:false,\u0026quot;blockId\u0026quot;:\u0026quot;20241120020631-on555bp\u0026quot;\u0026#125;,\u0026quot;3d07cae201b8af32526f5866dc61ccd2\u0026quot;:\u0026#123;\u0026quot;name\u0026quot;:\u0026quot;image-20241120013402-yk3hpqi.png\u0026quot;,\u0026quot;hash\u0026quot;:\u0026quot;3d07cae201b8af32526f5866dc61ccd2\u0026quot;,\u0026quot;originUrl\u0026quot;:\u0026quot;assets/image-20241120013402-yk3hpqi.png\u0026quot;,\u0026quot;url\u0026quot;:\u0026quot;https://syc-test111.oss-cn-chengdu.aliyuncs.com/image-20241120013402-yk3hpqi.png\u0026quot;,\u0026quot;alt\u0026quot;:\u0026quot;image\u0026quot;,\u0026quot;title\u0026quot;:\u0026quot;\u0026quot;,\u0026quot;isLocal\u0026quot;:false,\u0026quot;blockId\u0026quot;:\u0026quot;20241120020631-on555bp\u0026quot;\u0026#125;,\u0026quot;a122153a01c6548b084265635b339426\u0026quot;:\u0026#123;\u0026quot;name\u0026quot;:\u0026quot;image-20241120005629-675qjul.png\u0026quot;,\u0026quot;hash\u0026quot;:\u0026quot;a122153a01c6548b084265635b339426\u0026quot;,\u0026quot;originUrl\u0026quot;:\u0026quot;assets/image-20241120005629-675qjul.png\u0026quot;,\u0026quot;url\u0026quot;:\u0026quot;https://syc-test111.oss-cn-chengdu.aliyuncs.com/image-20241120005629-675qjul.png\u0026quot;,\u0026quot;alt\u0026quot;:\u0026quot;image\u0026quot;,\u0026quot;title\u0026quot;:\u0026quot;\u0026quot;,\u0026quot;isLocal\u0026quot;:false,\u0026quot;blockId\u0026quot;:\u0026quot;20241120020631-on555bp\u0026quot;\u0026#125;\u0026#125;","id":"20241120002759-6efz0dq","tags":"数据结构","title":"堆基础解析及操作","type":"doc","updated":"20241120022606"},"Children":[{"ID":"20241120013408-qckfgwk","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20241120013408-qckfgwk","updated":"20241120013438"},"Children":[{"Type":"NodeText","Data":"基础"}]},{"ID":"20241120005618-p1mtoyw","Type":"NodeParagraph","Properties":{"id":"20241120005618-p1mtoyw","updated":"20241120005623"},"Children":[{"Type":"NodeTextMark","TextMarkType":"u","TextMarkTextContent":"堆（heap）"},{"Type":"NodeText","Data":"是一种满足特定条件的完全二叉树，主要可分为两种类型。"}]},{"ID":"20241120005618-hfd6xdf","Type":"NodeList","ListData":{},"Properties":{"id":"20241120005618-hfd6xdf","updated":"20241120005618"},"Children":[{"ID":"20241120005616-wjh611j","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20241120005616-wjh611j","updated":"20241120005616"},"Children":[{"ID":"20241120005618-e1udy0m","Type":"NodeParagraph","Properties":{"id":"20241120005618-e1udy0m","updated":"20241120005618"},"Children":[{"Type":"NodeTextMark","TextMarkType":"u","TextMarkTextContent":"小顶堆（min heap）"},{"Type":"NodeText","Data":"：任意节点的值 ≤ 其子节点的值。"}]}]},{"ID":"20241120005616-kmz85kz","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20241120005616-kmz85kz","updated":"20241120005616"},"Children":[{"ID":"20241120005618-uh37wvw","Type":"NodeParagraph","Properties":{"id":"20241120005618-uh37wvw","updated":"20241120005618"},"Children":[{"Type":"NodeTextMark","TextMarkType":"u","TextMarkTextContent":"大顶堆（max heap）"},{"Type":"NodeText","Data":"：任意节点的值 ≥ 其子节点的值。"}]}]}]},{"ID":"20241120005629-5215mg2","Type":"NodeParagraph","Properties":{"id":"20241120005629-5215mg2","updated":"20241120005629"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20241120005629-675qjul.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20241120012126-u14464u","Type":"NodeParagraph","Properties":{"id":"20241120012126-u14464u","updated":"20241120012126"},"Children":[{"Type":"NodeText","Data":"堆作为完全二叉树的一个特例，具有以下特性。"}]},{"ID":"20241120012126-ts282ug","Type":"NodeList","ListData":{},"Properties":{"id":"20241120012126-ts282ug","updated":"20241120012126"},"Children":[{"ID":"20241120012116-e7xmbt6","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20241120012116-e7xmbt6","updated":"20241120012116"},"Children":[{"ID":"20241120012126-d02ebrm","Type":"NodeParagraph","Properties":{"id":"20241120012126-d02ebrm","updated":"20241120012126"},"Children":[{"Type":"NodeText","Data":"最底层节点靠左填充，其他层的节点都被填满。"}]}]},{"ID":"20241120012116-tzmxnbt","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20241120012116-tzmxnbt","updated":"20241120012116"},"Children":[{"ID":"20241120012126-zggvd2f","Type":"NodeParagraph","Properties":{"id":"20241120012126-zggvd2f","updated":"20241120012126"},"Children":[{"Type":"NodeText","Data":"我们将二叉树的根节点称为“堆顶”，将底层最靠右的节点称为“堆底”。"}]}]},{"ID":"20241120012116-8x27qq2","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20241120012116-8x27qq2","updated":"20241120012126"},"Children":[{"ID":"20241120012126-31fjrml","Type":"NodeParagraph","Properties":{"id":"20241120012126-31fjrml","updated":"20241120012126"},"Children":[{"Type":"NodeText","Data":"对于大顶堆（小顶堆），堆顶元素（根节点）的值是最大（最小）的。"}]}]}]},{"ID":"20241120013356-qrgilhx","Type":"NodeParagraph","Properties":{"id":"20241120013356-qrgilhx","updated":"20241120013356"},"Children":[{"Type":"NodeText","Data":"“二叉树”章节讲过，完全二叉树非常适合用数组来表示。由于堆正是一种完全二叉树，因此我们将采用数组来存储堆。"}]},{"ID":"20241120013356-8war140","Type":"NodeParagraph","Properties":{"id":"20241120013356-8war140","updated":"20241120013356"},"Children":[{"Type":"NodeText","Data":"当使用数组表示二叉树时，元素代表节点值，索引代表节点在二叉树中的位置。节点指针通过索引映射公式来实现。"}]},{"ID":"20241120013402-4eb8tj2","Type":"NodeParagraph","Properties":{"id":"20241120013402-4eb8tj2","updated":"20241120013402"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20241120013402-yk3hpqi.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20241120013403-kp69356","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20241120013403-kp69356","updated":"20241120014340"},"Children":[{"Type":"NodeText","Data":"操作"}]},{"ID":"20241120013549-nj0rr3e","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20241120013549-nj0rr3e","updated":"20241120014340"},"Children":[{"Type":"NodeText","Data":"入堆"}]},{"ID":"20241120013627-4nedq9i","Type":"NodeParagraph","Properties":{"id":"20241120013627-4nedq9i","updated":"20241120013638"},"Children":[{"Type":"NodeText","Data":"给定元素 val ，我们首先将其添加到堆底。添加之后，由于 val 可能大于堆中其他元素，堆的成立条件可能已被破坏，因此需要修复从插入节点到根节点的路径上的各个节点，这个操作被称为堆化（heapify）。"}]},{"ID":"20241120013640-lkxumtf","Type":"NodeParagraph","Properties":{"id":"20241120013640-lkxumtf","updated":"20241120014339"},"Children":[{"Type":"NodeText","Data":"考虑从入堆节点开始，从底至顶执行堆化。比较插入节点与其父节点的值，如果插入节点更大，则将它们交换。"}]},{"ID":"20241120014340-x0eqpnz","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20241120014340-x0eqpnz","updated":"20241120014748"},"Children":[{"Type":"NodeText","Data":"出堆"}]},{"ID":"20241120014449-ij73til","Type":"NodeList","ListData":{},"Properties":{"id":"20241120014449-ij73til","updated":"20241120014449"},"Children":[{"ID":"20241120014447-lzkin1n","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20241120014447-lzkin1n","updated":"20241120014447"},"Children":[{"ID":"20241120014449-13haje7","Type":"NodeParagraph","Properties":{"id":"20241120014449-13haje7","updated":"20241120014449"},"Children":[{"Type":"NodeText","Data":"交换堆顶元素与堆底元素（交换根节点与最右叶节点）。"}]}]},{"ID":"20241120014447-4dhs1sk","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20241120014447-4dhs1sk","updated":"20241120014447"},"Children":[{"ID":"20241120014449-3j6jx3u","Type":"NodeParagraph","Properties":{"id":"20241120014449-3j6jx3u","updated":"20241120014449"},"Children":[{"Type":"NodeText","Data":"交换完成后，将堆底从列表中删除（注意，由于已经交换，因此实际上删除的是原来的堆顶元素）。"}]}]},{"ID":"20241120014447-zyu2uxh","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20241120014447-zyu2uxh","updated":"20241120014447"},"Children":[{"ID":"20241120014449-d2n8stl","Type":"NodeParagraph","Properties":{"id":"20241120014449-d2n8stl","updated":"20241120014449"},"Children":[{"Type":"NodeText","Data":"从根节点开始，"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"从顶至底执行堆化"},{"Type":"NodeText","Data":"。"}]}]}]},{"ID":"20241120014449-lgoxwkl","Type":"NodeParagraph","Properties":{"id":"20241120014449-lgoxwkl","updated":"20241120014547"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"“从顶至底堆化”的操作方向与“从底至顶堆化”相反"},{"Type":"NodeText","Data":"，我们将根节点的值与其两个子节点的值进行比较，将最大的子节点与根节点交换。然后循环执行此操作，直到越过叶节点或遇到无须交换的节点时结束。"}]},{"ID":"20241120014748-gyjxd5i","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20241120014748-gyjxd5i","updated":"20241120020305"},"Children":[{"Type":"NodeText","Data":"建堆"}]},{"ID":"20241120014755-49zuizi","Type":"NodeParagraph","Properties":{"id":"20241120014755-49zuizi","updated":"20241120020009"},"Children":[{"Type":"NodeText","Data":"除了对每个元素执行入堆操作以外，可以采用直接遍历，自顶向下把原有数组直接堆化，由于叶子节点数量很多，实际操作次数（实际复杂度）是O(n)。"}]},{"ID":"20241120020051-urrdssc","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20241120020051-urrdssc","updated":"20241120020051"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"amF2YQ=="},{"Type":"NodeCodeBlockCode","Data":"/* 构造方法，根据输入列表建堆 */\nMaxHeap(List\u003cInteger\u003e nums) {\n    // 将列表元素原封不动添加进堆\n    maxHeap = new ArrayList\u003c\u003e(nums);\n    // 堆化除叶节点以外的其他所有节点\n    for (int i = parent(size() - 1); i \u003e= 0; i--) {\n        siftDown(i);\n    }\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20241120020056-yx29utz","Type":"NodeParagraph","Properties":{"id":"20241120020056-yx29utz","updated":"20241120020305"},"Children":[{"Type":"NodeText","Data":"看起来是nlogn的复杂度，实际上因为不同的层的操作次数是不一样的，每次堆化操作的复杂度并非都是O(logn)，最后经数学推导可知，复杂度为O(n)"}]},{"ID":"20241120014610-w68na6z","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20241120014610-w68na6z","updated":"20241120014623"},"Children":[{"Type":"NodeText","Data":"特性"}]},{"ID":"20241120014548-8hdw45h","Type":"NodeParagraph","Properties":{"id":"20241120014548-8hdw45h","updated":"20241120014606"},"Children":[{"Type":"NodeText","Data":"堆通常作为实现优先队列的首选数据结构，其入队和出队操作的时间复杂度均为 O(log⁡n) ，而建堆操作为 O(n) ，这些操作都非常高效。"}]},{"ID":"20241120014623-aa959z9","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20241120014623-aa959z9","updated":"20241120022606"},"Children":[{"Type":"NodeText","Data":"Top-k问题"}]},{"ID":"20241120020604-7genw9c","Type":"NodeParagraph","Properties":{"id":"20241120020604-7genw9c","updated":"20241120020604"},"Children":[{"Type":"NodeText","Data":"我们可以基于堆更加高效地解决 Top-k 问题，流程如图 8-8 所示。"}]},{"ID":"20241120020604-snqnqxs","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20241120020604-snqnqxs","updated":"20241120020604"},"Children":[{"ID":"20241120020603-tbxg2zs","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"MS4=","Num":1},"Properties":{"id":"20241120020603-tbxg2zs","updated":"20241120020603"},"Children":[{"ID":"20241120020604-qt22cui","Type":"NodeParagraph","Properties":{"id":"20241120020604-qt22cui","updated":"20241120020604"},"Children":[{"Type":"NodeText","Data":"初始化一个小顶堆，其堆顶元素最小。"}]}]},{"ID":"20241120020603-l4zhjr4","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"Mi4=","Num":2},"Properties":{"id":"20241120020603-l4zhjr4","updated":"20241120020603"},"Children":[{"ID":"20241120020604-8l5tlwo","Type":"NodeParagraph","Properties":{"id":"20241120020604-8l5tlwo","updated":"20241120020604"},"Children":[{"Type":"NodeText","Data":"先将数组的前 k 个元素依次入堆。"}]}]},{"ID":"20241120020603-bk500x4","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"My4=","Num":3},"Properties":{"id":"20241120020603-bk500x4","updated":"20241120020603"},"Children":[{"ID":"20241120020604-lllg7pt","Type":"NodeParagraph","Properties":{"id":"20241120020604-lllg7pt","updated":"20241120020604"},"Children":[{"Type":"NodeText","Data":"从第 k+1 个元素开始，若当前元素大于堆顶元素，则将堆顶元素出堆，并将当前元素入堆。"}]}]},{"ID":"20241120020603-6wghi99","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"NC4=","Num":4},"Properties":{"id":"20241120020603-6wghi99","updated":"20241120020603"},"Children":[{"ID":"20241120020604-ncnib0y","Type":"NodeParagraph","Properties":{"id":"20241120020604-ncnib0y","updated":"20241120020604"},"Children":[{"Type":"NodeText","Data":"遍历完成后，堆中保存的就是最大的 k 个元素。"}]}]}]},{"ID":"20241120020631-on555bp","Type":"NodeParagraph","Properties":{"id":"20241120020631-on555bp","updated":"20241120022606"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"https://syc-test111.oss-cn-chengdu.aliyuncs.com/image-20241120020631-gfu3rbn.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20241120020632-0ledfcr","Type":"NodeParagraph","Properties":{"id":"20241120020632-0ledfcr","updated":"20241120020632"}}]}